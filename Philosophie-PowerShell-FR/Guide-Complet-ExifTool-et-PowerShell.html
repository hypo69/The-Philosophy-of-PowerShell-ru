# Guide complet d'ExifTool et PowerShell

Chaque fois que vous prenez une photo, votre appareil photo enregistre dans le fichier non seulement l'image elle-m√™me, mais aussi des informations de service : mod√®le d'appareil photo et d'objectif, date et heure de prise de vue, vitesse d'obturation, ouverture, ISO, coordonn√©es GPS. Ces donn√©es sont appel√©es **EXIF (Exchangeable Image File Format)**.

Bien que PowerShell dispose d'outils int√©gr√©s pour lire certaines m√©tadonn√©es, ils sont limit√©s. Pour acc√©der √† **toutes** les informations, un outil sp√©cialis√© est n√©cessaire.
Dans cet article, j'utilise **ExifTool**.


**ExifTool** est un utilitaire gratuit, multiplateforme et open source √©crit par Phil Harvey. C'est la r√©f√©rence pour la lecture, l'√©criture et l'√©dition de m√©tadonn√©es dans une grande vari√©t√© de formats de fichiers (images, audio, vid√©o, PDF, etc.). ExifTool conna√Æt des milliers de balises de centaines de fabricants d'appareils, ce qui en fait l'outil le plus complet de sa cat√©gorie.

### T√©l√©chargement et configuration correcte

Avant d'√©crire du code, vous devez pr√©parer l'utilitaire lui-m√™me.

1.  Rendez-vous sur le **site officiel d'ExifTool : [https://exiftool.org/](https://exiftool.org/)**. Sur la page principale, trouvez et t√©l√©chargez le **"Windows Executable"**.

2.  **Renommage (√©tape cruciale !) :** Le fichier t√©l√©charg√© s'appellera `exiftool(-k).exe`. Ce n'est pas un hasard.

Renommez-le en **`exiftool.exe`** pour **d√©sactiver le mode "pause"**, qui est destin√© aux utilisateurs qui lancent le programme en double-cliquant.
>

3.  **Stockage :** Vous avez deux options principales pour stocker `exiftool.exe`.
    *   **Option 1 (Simple) : Dans le m√™me dossier que votre script.** C'est le moyen le plus simple. Votre script PowerShell pourra toujours trouver l'utilitaire, car il se trouve √† proximit√©. Id√©al pour les scripts portables que vous transf√©rez d'un ordinateur √† l'autre.
    *   **Option 2 (Recommand√©e pour une utilisation fr√©quente) : Dans un dossier de la variable syst√®me `PATH`.** La variable `PATH` est une liste de r√©pertoires o√π Windows et PowerShell recherchent automatiquement les fichiers ex√©cutables. 
    Vous pouvez cr√©er un dossier (par exemple, `C:\Tools`), y placer `exiftool.exe` et ajouter `C:\Tools` √† la variable syst√®me `PATH`. 
    Apr√®s cela, vous pourrez appeler `exiftool.exe` depuis n'importe quel dossier dans n'importe quelle console.


Scripts √† ajouter au $PATH :
Ajout d'un r√©pertoire au PATH pour l'UTILISATEUR ACTUEL
Ajout d'un r√©pertoire au PATH SYST√àME pour TOUS LES UTILISATEURS

---

## PowerShell et programmes externes

Pour utiliser efficacement ExifTool, vous devez savoir comment PowerShell ex√©cute les fichiers `.exe` externes.
La m√©thode correcte et la plus fiable pour ex√©cuter des programmes externes est l'**op√©rateur d'appel `&` (esperluette)**.
PowerShell g√©n√©rera une erreur si le chemin du programme contient des espaces. Par exemple, `C:\Mes Outils\programme.exe`.
`&` (esperluette)** indique √† PowerShell : "Le texte qui me suit entre guillemets est le chemin d'acc√®s au fichier ex√©cutable. Ex√©cutez-le, et tout ce qui suit sont ses arguments."

```powershell
# Syntaxe correcte
& "C:\Chemin Avec Espaces\programme.exe" "argument 1" "argument 2"
```

Utilisez toujours `&` lorsque vous travaillez avec des chemins de programme dans des variables ou des chemins qui peuvent contenir des espaces.

---

## Astuces pratiques : ExifTool + PowerShell

Maintenant, combinons nos connaissances.

### Exemple n¬∞1 : Extraction de base et visualisation interactive

Le moyen le plus simple d'obtenir toutes les donn√©es d'une photo et de les examiner est de les demander au format JSON et de les transmettre √† `Out-ConsoleGridView`.

```powershell
$photoPath = "D:\Photos\IMG_1234.JPG"

# 1. Lancer exiftool avec la cl√© -json pour une sortie structur√©e
# 2. Convertir le texte JSON en objet PowerShell
#    Appeler exiftool.exe directement, sans variable et sans op√©rateur d'appel &.
$exifObject = exiftool.exe -json $photoPath | ConvertFrom-Json

# 3. Transformer l'objet "large" en un tableau pratique "Param√®tre-Valeur"
$reportData = $exifObject.psobject.Properties | Select-Object Name, Value

# 4. Afficher le r√©sultat dans une fen√™tre interactive pour analyse
$reportData | Out-ConsoleGridView -Title "M√©tadonn√©es du fichier : $($photoPath | Split-Path -Leaf)"
```

Ce code ouvrira une fen√™tre interactive o√π vous pourrez trier les donn√©es par nom de param√®tre ou par valeur, et √©galement les filtrer en commen√ßant simplement √† taper. C'est incroyablement pratique pour trouver rapidement les informations dont vous avez besoin.

### Exemple n¬∞2 : Cr√©ation d'un rapport propre et envoi vers diff√©rents "appareils"

`Out-ConsoleGridView` n'est que le d√©but. Vous pouvez diriger les donn√©es trait√©es n'importe o√π en utilisant d'autres cmdlets `Out-*`.

Supposons que nous ayons des donn√©es dans la variable `$reportData` de l'exemple pr√©c√©dent.

#### **A) Envoi vers un fichier CSV pour Excel**
```powershell
$reportData | Export-Csv -Path "C:\Reports\photo_exif.csv" -NoTypeInformation -Encoding UTF8
```
La commande `Export-Csv` cr√©e un fichier parfaitement structur√© qui peut √™tre ouvert dans Excel ou Google Sheets.

#### **B) Envoi vers un fichier texte**
```powershell
# Pour un formatage agr√©able, utilisez d'abord Format-Table
$reportData | Format-Table -AutoSize | Out-File -FilePath "C:\Reports\photo_exif.txt"
```
La commande `Out-File` enregistrera dans un fichier une copie texte exacte de ce que vous voyez dans la console.

#### **C) Envoi vers le presse-papiers**
Vous voulez coller rapidement des donn√©es dans un e-mail ou un chat ? Utilisez `Out-Clipboard`.
```powershell
$reportData | Format-Table -AutoSize | Out-String | Out-Clipboard
```

Vous pouvez maintenant appuyer sur `Ctrl+V` dans n'importe quel √©diteur de texte et coller un tableau joliment format√©.

### Exemple n¬∞3 : Obtention de donn√©es sp√©cifiques pour une utilisation dans un script

Souvent, vous n'avez pas besoin de tout le rapport, mais seulement d'une ou deux valeurs. Puisque `$exifObject` est un objet PowerShell ordinaire, vous pouvez facilement acc√©der √† ses propri√©t√©s.

```powershell

$photoPath = "D:\Photos\IMG_1234.JPG"

# Appeler exiftool.exe directement par son nom.
# PowerShell le trouvera automatiquement dans l'un des dossiers list√©s dans PATH.
$exifObject = exiftool.exe -json $photoPath | ConvertFrom-Json

# 1. Cr√©er un objet PowerShell avec des noms de propri√©t√©s clairs.
#    Ceci est similaire √† la cr√©ation d'un enregistrement structur√©.
$reportObject = [PSCustomObject]@{
    "Appareil photo"           = $exifObject.Model
    "Date de prise de vue"      = $exifObject.DateTimeOriginal
    "Sensibilit√©" = $exifObject.ISO
    "Nom du fichier"        = $exifObject.FileName # Ajouter le nom du fichier pour le contexte
}

# 2. Afficher cet objet dans une fen√™tre interactive.
#    Out-GridView cr√©era automatiquement des colonnes √† partir des noms de propri√©t√©s.
$reportObject | Out-ConsoleGridView -Title "M√©tadonn√©es du fichier : $(Split-Path $photoPath -Leaf)"
```

Cette approche est la base de toute automatisation s√©rieuse, telle que le renommage de fichiers en fonction de la date de prise de vue, le tri de photos par mod√®le d'appareil photo ou l'ajout de filigranes avec des informations d'exposition.

### Exemple n¬∞4 : Extraction par lots de m√©tadonn√©es d'un dossier

Parfois, vous devez analyser non pas une seule photo, mais un dossier entier d'images.

```powershell
# Sp√©cifier uniquement le dossier photo.
$photoFolder = "D:\Photos"

# Appeler exiftool.exe directement. Aucune variable pour le chemin et aucun op√©rateur & ne sont n√©cessaires.
$allExif = exiftool.exe -json "$photoFolder\*.jpg" | ConvertFrom-Json

# Convertir dans un format pratique 
$report = foreach ($photo in $allExif) {
    [PSCustomObject]@{
        # --- Donn√©es de base sur le fichier et l'appareil photo ---
        FileName       = $photo.FileName
        DateTime       = $photo.DateTimeOriginal
        CameraMake     = $photo.Make                 # Fabricant (par exemple, "Canon", "SONY")
        CameraModel    = $photo.Model                 # Mod√®le d'appareil photo (par exemple, "EOS R5")
        LensModel      = $photo.LensID                # Nom complet du mod√®le d'objectif
        
        # --- Param√®tres de prise de vue (exposition) ---
        ISO            = $photo.ISO
        ShutterSpeed   = $photo.ShutterSpeed
        Aperture       = $photo.Aperture
        FocalLength    = $photo.FocalLength           # Longueur focale (par exemple, "50.0 mm")
        ExposureMode   = $photo.ExposureProgram       # Mode de prise de vue (par exemple, "Manuel", "Priorit√© √† l'ouverture")
        Flash          = $photo.Flash                 # Informations sur le d√©clenchement du flash
        
        # --- GPS et donn√©es d'image ---
        GPSPosition    = $photo.GPSPosition           # Coordonn√©es GPS sous forme de cha√Æne unique (si disponible)
        Dimensions     = "$($photo.ImageWidth)x$($photo.ImageHeight)" # Dimensions de l'image en pixels
    }
}

# Afficher les donn√©es dans un tableau interactif dans la CONSOLE
$report | Out-ConsoleGridView -Title "Rapport r√©capitulatif pour le dossier : $photoFolder"
```

üí° Vous obtenez un tableau soign√© pour l'ensemble du dossier en une seule fois.

---

### Exemple n¬∞5 : Recherche r√©cursive dans les sous-dossiers

ExifTool peut rechercher des fichiers dans tous les sous-dossiers √† l'aide de la cl√© `-r`.

```powershell
& $exifToolPath -r -json "D:\Photos" | ConvertFrom-Json |
    Select-Object FileName, Model, DateTimeOriginal |
    Export-Csv "C:\Reports\all_photos_recursive.csv" -NoTypeInformation -Encoding UTF8
```

---

### Exemple n¬∞6 : Renommer les fichiers par date de prise de vue

C'est l'un des sc√©narios d'automatisation les plus populaires ‚Äî les fichiers sont nomm√©s par la date/heure de leur prise de vue.

```powershell
$exifToolPath = "C:\Tools\exiftool.exe"
$photoFolder = "D:\Photos"

# Renommer au format AAAA-MM-JJ_HH-MM-SS.jpg
& $exifToolPath -r -d "%Y-%m-%d_%H-%M-%S.%%e" "-FileName<DateTimeOriginal" $photoFolder
```

üí° *ExifTool substituera automatiquement l'extension de fichier d'origine via `%%e`.*

---

### Exemple n¬∞7 : Extraction des seules coordonn√©es GPS

Utile si vous souhaitez construire une carte √† partir de vos photos.

```powershell
# 1. Sp√©cifiez le chemin d'acc√®s √† votre dossier photo
$photoFolder = "E:\DCIM\Camera"

# 2. Listez les balises dont nous avons besoin : nom de fichier et trois balises GPS.
#    Cela rend la requ√™te beaucoup plus rapide que si nous devions r√©cup√©rer toutes les balises.
$tagsToExtract = @(
    "-SourceFile", # SourceFile est meilleur que FileName, car il contient g√©n√©ralement le chemin complet
    "-GPSLatitude",
    "-GPSLongitude",
    "-GPSAltitude"
)

# 3. Appeler exiftool.exe directement (puisqu'il est dans PATH).
#    Le commutateur -r recherche les fichiers dans tous les sous-dossiers.
#    Convertir le r√©sultat directement √† partir de JSON.
$allExifData = exiftool.exe -r -json $tagsToExtract $photoFolder | ConvertFrom-Json

# 4. Filtrer les r√©sultats : ne conserver QUE les objets qui ont une latitude et une longitude.
$filesWithGps = $allExifData | Where-Object { $_.GPSLatitude -and $_.GPSLongitude }

# 5. V√©rifier si des fichiers avec des donn√©es GPS ont √©t√© trouv√©s
if ($filesWithGps) {
    # 6. Cr√©er un joli rapport √† partir des donn√©es filtr√©es.
    #    Utiliser Select-Object pour renommer les colonnes et formater.
    $report = $filesWithGps | Select-Object @{Name="Nom du fichier"; Expression={Split-Path $_.SourceFile -Leaf}},
                                             @{Name="Latitude"; Expression={$_.GPSLatitude}},
                                             @{Name="Longitude"; Expression={$_.GPSLongitude}},
                                             @{Name="Altitude"; Expression={if ($_.GPSAltitude) { "$($_.GPSAltitude) m" } else { "N/A" }}}
    
    # 7. Afficher le rapport final dans un tableau de console interactif.
    $report | Out-ConsoleGridView -Title "Fichiers avec donn√©es GPS dans le dossier : $photoFolder"

} else {
    # Si rien n'est trouv√©, informer poliment l'utilisateur.
    Write-Host "Aucun fichier avec des donn√©es GPS trouv√© dans le dossier '$photoFolder'." -ForegroundColor Yellow
}
```

---

### Exemple n¬∞8 : Suppression en masse de toutes les donn√©es GPS (pour la confidentialit√©)

```powershell
# Supprimer toutes les balises GPS des JPG et PNG
& $exifToolPath -r -overwrite_original -gps:all= "D:\Photos"
```

üí° *Cette action est irr√©versible, alors faites une sauvegarde avant d'ex√©cuter.*

---

### Exemple n¬∞9 : Conversion de l'heure de prise de vue en heure locale

Parfois, les photos sont prises dans un fuseau horaire diff√©rent. ExifTool peut d√©caler la date.

```powershell
# D√©caler l'heure de +3 heures
& $exifToolPath "-AllDates+=3:0:0" "D:\Photos\IMG_*.JPG"
```

---

### Exemple n¬∞10 : Obtenir une liste de tous les mod√®les d'appareils photo uniques dans un dossier

```powershell
$models = & $exifToolPath -r -Model -s3 "D:\Photos" | Sort-Object -Unique
$models | ForEach-Object { Write-Host "Mod√®le : $_" }
```

---

### Exemple n¬∞11 : Affichage des seules balises n√©cessaires sous forme de tableau

```powershell
& $exifToolPath -T -Model -DateTimeOriginal -ISO -Aperture -ShutterSpeed "D:\Photos\IMG_1234.JPG"
```

`-T` affiche le r√©sultat au format tabulaire, s√©par√© par des tabulations ‚Äî pratique pour un traitement ult√©rieur.

---

### Exemple n¬∞12 : V√©rification de la pr√©sence de GPS dans un grand tableau de fichiers

```powershell
$files = & $exifToolPath -r -if "$gpslatitude" -p '$FileName' "D:\Photos"
Write-Host "Fichiers avec GPS:"
$files
```

---

### Exemple n¬∞13 : Copie de m√©tadonn√©es d'un fichier √† l'autre

```powershell
# 1. S√©lectionner le fichier source
$sourceFile = Get-ChildItem "D:\Photos" -Filter "*.jpg" | Out-ConsoleGridView -Title "S√©lectionner le fichier SOURCE"

# 2. Si la source est s√©lectionn√©e, s√©lectionner les fichiers cibles
if ($sourceFile) {
    $targetFiles = Get-ChildItem "D:\Photos\New" -Filter "*.jpg" | Out-ConsoleGridView -Title "S√©lectionner les fichiers CIBLES pour copier les m√©tadonn√©es" -OutputMode Multiple
    
    # 3. Si les cibles sont s√©lectionn√©es, effectuer la copie
    if ($targetFiles) {
        & exiftool.exe -TagsFromFile $sourceFile.FullName ($targetFiles.FullName)
        Write-Host "M√©tadonn√©es copi√©es de $($sourceFile.Name) vers $($targetFiles.Count) fichiers."
    }
}
```

---

### Exemple n¬∞14 : Enregistrement des m√©tadonn√©es originales dans un JSON s√©par√© avant modification

```powershell
$backupPath = "C:\Reports\metadata_backup.json"
& $exifToolPath -r -json "D:\Photos" | Out-File -Encoding UTF8 $backupPath
```

---

### Exemple n¬∞15 : Utilisation de PowerShell pour le tri automatique des photos par date

```powershell
$photos = Get-ChildItem "D:\Photos" -Filter *.jpg -Recurse
foreach ($photo in $photos) {
    $meta = & $exifToolPath -json $photo.FullName | ConvertFrom-Json
    $date = Get-Date $meta.DateTimeOriginal -ErrorAction SilentlyContinue
    if ($date) {
        $targetFolder = "D:\Sorted\{0:yyyy}\{0:MM}" -f $date
        if (-not (Test-Path $targetFolder)) { New-Item -Path $targetFolder -ItemType Directory }
        Move-Item $photo.FullName -Destination $targetFolder
    }
}
```

---


### Exemple 16 : Recherche de tous les mod√®les d'appareils photo uniques dans une collection

Bien que cela puisse √™tre fait en une seule ligne, l'affichage dans `GridView` permet de copier imm√©diatement le nom du mod√®le souhait√©.

```powershell
# La cl√© -s3 n'affiche que les valeurs, -Model - le nom de la balise
$uniqueModels = & exiftool.exe -r -Model -s3 "D:\Photos" | Sort-Object -Unique

# Afficher dans GridView pour une visualisation et une copie faciles
$uniqueModels | Out-ConsoleGridView -Title "Mod√®les d'appareils photo uniques dans la collection"
```
