<h2>Disk Diagnostics and Recovery with PowerShell</h2>
<p>PowerShell allows you to automate checks, perform remote diagnostics, and create flexible scripts for monitoring. This guide will walk you through basic checks to in-depth disk diagnostics and recovery.</p>
<p><b>Version:</b> This guide is relevant for <b>Windows 10/11</b> and <b>Windows Server 2016+</b>.</p>
<h2>Key Cmdlets for Disk Management</h2>
<table>
<thead>
<tr>
<th>Cmdlet</th>
<th>Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>Get-PhysicalDisk</code></td>
<td>Information about physical disks (model, health status).</td>
</tr>
<tr>
<td><code>Get-Disk</code></td>
<td>Information about disks at the device level (Online/Offline status, partition style).</td>
</tr>
<tr>
<td><code>Get-Partition</code></td>
<td>Information about partitions on disks.</td>
</tr>
<tr>
<td><code>Get-Volume</code></td>
<td>Information about logical volumes (drive letters, file system, free space).</td>
</tr>
<tr>
<td><code>Repair-Volume</code></td>
<td>Check and repair logical volumes (analogous to <code>chkdsk</code>).</td>
</tr>
<tr>
<td><code>Get-StoragePool</code></td>
<td>Used for working with Storage Spaces.</td>
</tr>
</tbody>
</table>
<hr>
<h2>Step 1: Basic System Health Check</h2>
<p>Start with a general assessment of the disk subsystem's health.</p>
<h3>Viewing all connected disks</h3>
<p><code>Get-Disk</code> command provides summary information about all disks seen by the operating system.</p>
<pre class="line-numbers"><code class="language-powershell">Get-Disk
</code></pre>
<p>You will see a table with disk numbers, their sizes, status (<code>Online</code> or <code>Offline</code>), and partition style (<code>MBR</code> or <code>GPT</code>).</p>
<p><b>Example:</b> Find all disks that are offline.</p>
<pre class="line-numbers"><code class="language-powershell">Get-Disk | Where-Object IsOffline -eq $true
</code></pre>
<h3>Checking physical disk health</h3>
<p><code>Get-PhysicalDisk</code> cmdlet accesses the state of the hardware itself.</p>
<pre class="line-numbers"><code class="language-powershell">Get-PhysicalDisk | Select-Object FriendlyName, MediaType, HealthStatus, OperationalStatus
</code></pre>
<p>Pay special attention to the <code>HealthStatus</code> field. It can take the following values:</p>
<ul>
<li><b>Healthy:</b> The disk is fine.</li>
<li><b>Warning:</b> There are issues, attention is required (e.g., S.M.A.R.T. thresholds exceeded).</li>
<li><b>Unhealthy:</b> The disk is in a critical state and may fail.</li>
</ul>
<hr>
<h2>Step 2: Analyzing and Recovering Logical Volumes</h2>
<p>After checking the physical condition, we move on to the logical structure — volumes and the file system.</p>
<h3>Information about logical volumes</h3>
<p><code>Get-Volume</code> command shows all mounted volumes in the system.</p>
<pre class="line-numbers"><code class="language-powershell">Get-Volume | Format-Table DriveLetter, FileSystem, HealthStatus, SizeRemaining, Size
</code></pre>
<p>Key fields:</p>
<ul>
<li><code>DriveLetter</code> — Volume letter (C, D, etc.).</li>
<li><code>FileSystem</code> — File system type (NTFS, ReFS, FAT32).</li>
<li><code>HealthStatus</code> — Volume status.</li>
<li><code>SizeRemaining</code> and <code>Size</code> — Free and total space.</li>
</ul>
<h3>Checking and repairing a volume (analogous to <code>chkdsk</code>)</h3>
<p><code>Repair-Volume</code> cmdlet is a modern replacement for the <code>chkdsk</code> utility.</p>
<p><b>1. Checking a volume without repairs (scan only)</b></p>
<p>This mode is safe to run on a running system; it only looks for errors.</p>
<pre class="line-numbers"><code class="language-powershell">Repair-Volume -DriveLetter C -Scan
</code></pre>
<p><b>2. Full scan and error correction</b></p>
<p>This mode is analogous to <code>chkdsk C: /f</code>. It locks the volume during operation, so a reboot will be required for the system drive.</p>
<pre class="line-numbers"><code class="language-powershell">Repair-Volume -DriveLetter C -OfflineScanAndFix
</code></pre>
<p>❗️ <b>Important:</b> If you run this command for the system drive (C:), PowerShell will schedule a check on the next system boot. To run it immediately, restart your computer.</p>
<p><b>Example:</b> Automatically check and repair all volumes whose status is not <code>Healthy</code>.</p>
<pre class="line-numbers"><code class="language-powershell">Get-Volume | Where-Object {$_.HealthStatus -ne 'Healthy'} | ForEach-Object {
    Write-Host "Repairing volume $($_.DriveLetter)..."
    Repair-Volume -DriveLetter $_.DriveLetter -OfflineScanAndFix
}
</code></pre>
<hr>
<h2>Step 3: In-depth Diagnostics and S.M.A.R.T.</h2>
<p>If basic checks did not reveal problems, but suspicions remain, you can dig deeper.</p>
<h3>Analyzing system logs</h3>
<p>Disk subsystem errors are often recorded in the Windows system log.</p>
<pre class="line-numbers"><code class="language-powershell">Get-WinEvent -LogName System | Where-Object {$_.Message -like "*disk*"} | Select-Object -First 20
</code></pre>
<p>For a more precise search, you can filter by event source:</p>
<pre class="line-numbers"><code class="language-powershell">Get-WinEvent -ProviderName 'Microsoft-Windows-DiskDiagnostic' -MaxEvents 10
</code></pre>
<h3>Checking S.M.A.R.T. status</h3>
<p>S.M.A.R.T. (Self-Monitoring, Analysis and Reporting Technology) is a disk self-diagnosis technology. PowerShell allows you to get this data.</p>
<p><b>Method 1: Using WMI (for compatibility)</b></p>
<pre class="line-numbers"><code class="language-powershell">Get-WmiObject -Namespace "root\wmi" -Class MSStorageDriver_FailurePredictStatus
</code></pre>
<p>If <code>PredictFailure = True</code>, the disk predicts an imminent failure. This is a signal for immediate replacement.</p>
<p><b>Method 2: Modern approach via CIM and Storage modules</b></p>
<p>A more modern and detailed way is to use the <code>Get-StorageReliabilityCounter</code> cmdlet.</p>
<pre class="line-numbers"><code class="language-powershell">Get-PhysicalDisk | Get-StorageReliabilityCounter | Select-Object PhysicalDisk, Wear, Temperature, ReadErrorsTotal, WriteErrorsTotal
</code></pre>
<p>This cmdlet provides valuable information such as wear (relevant for SSDs), temperature, and the number of read/write errors.</p>
<hr>
<h2>Practical Scenarios for a System Administrator</h2>
<p>Here are some ready-made examples for everyday tasks.</p>
<p><b>1. Get a brief report on the health of all physical disks.</b></p>
<pre class="line-numbers"><code class="language-powershell">Get-PhysicalDisk | Format-Table DeviceID, FriendlyName, MediaType, HealthStatus, OperationalStatus
</code></pre>
<p><b>2. Create a CSV report on free space on all volumes.</b></p>
<pre class="line-numbers"><code class="language-powershell">Get-Volume | Select-Object DriveLetter, FileSystemLabel, @{N='Size(GB)';E={[math]::Round($_.Size / 1GB, 2)}}, @{N='FreeSpace(GB)';E={[math]::Round($_.SizeRemaining / 1GB, 2)}} | Export-Csv -Path C:\Reports\DiskSpace.csv -NoTypeInformation -Encoding UTF8
</code></pre>
<p><b>3. Find all partitions on a specific disk (e.g., disk 0).</b></p>
<pre class="line-numbers"><code class="language-powershell">Get-Partition -DiskNumber 0
</code></pre>
<p><b>4. Run system disk diagnostics with subsequent reboot.</b></p>
<pre class="line-numbers"><code class="language-powershell">Repair-Volume -DriveLetter C -OfflineScanAndFix
Restart-Computer -Force
</code></pre>