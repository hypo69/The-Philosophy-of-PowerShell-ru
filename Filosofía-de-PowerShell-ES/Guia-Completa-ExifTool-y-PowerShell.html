# Gu칤a Completa de ExifTool y PowerShell

Cada vez que tomas una fotograf칤a, tu c치mara registra en el archivo no solo la imagen en s칤, sino tambi칠n informaci칩n de servicio: el modelo de la c치mara y el objetivo, la fecha y hora de la toma, la velocidad de obturaci칩n, la apertura, el ISO, las coordenadas GPS. Estos datos se denominan **EXIF (Exchangeable Image File Format)**.

Aunque PowerShell tiene herramientas integradas para leer algunos metadatos, son limitadas. Para acceder a **toda** la informaci칩n, se necesita una herramienta especializada. En este art칤culo, utilizo **ExifTool**.

**ExifTool** es una utilidad gratuita, multiplataforma y de c칩digo abierto, escrita por Phil Harvey. Es el est치ndar de oro para leer, escribir y editar metadatos en una amplia variedad de formatos de archivo (im치genes, audio, video, PDF, etc.). ExifTool conoce miles de etiquetas de cientos de fabricantes de dispositivos, lo que lo convierte en la herramienta m치s completa de su clase.

### Descarga y configuraci칩n correcta

Antes de escribir cualquier c칩digo, debe preparar la utilidad en s칤.

1.  Vaya al **sitio web oficial de ExifTool: [https://exiftool.org/](https://exiftool.org/)**. En la p치gina principal, busque y descargue **"Windows Executable"**.

2.  **Cambio de nombre (춰Paso cr칤ticamente importante!):** El archivo descargado se llamar치 `exiftool(-k).exe`. Esto no es accidental.

    C치mbiele el nombre a **`exiftool.exe`** para **desactivar el modo "pausa"**, que est치 destinado a los usuarios que inician el programa haciendo doble clic.

3.  **Almacenamiento:** Tiene dos opciones principales sobre d칩nde almacenar `exiftool.exe`.
    *   **Opci칩n 1 (Simple): En la misma carpeta que su script.** Esta es la forma m치s f치cil. Su script de PowerShell siempre podr치 encontrar la utilidad, ya que est치 ubicada cerca. Ideal para scripts port치tiles que mueve de una computadora a otra.
    *   **Opci칩n 2 (Recomendada para uso frecuente): En una carpeta de la variable del sistema `PATH`.** La variable `PATH` es una lista de directorios donde Windows y PowerShell buscan autom치ticamente archivos ejecutables.
        Puede crear una carpeta (por ejemplo, `C:\Tools`), colocar `exiftool.exe` all칤 y agregar `C:\Tools` a la variable del sistema `PATH`.
        Despu칠s de eso, podr치 llamar a `exiftool.exe` desde cualquier carpeta en cualquier consola.

Scripts para agregar a `$PATH`:
Agregar un directorio a `PATH` para el USUARIO ACTUAL
Agregar un directorio al `PATH` del SISTEMA para TODOS LOS USUARIOS

---

## PowerShell y programas externos

Para usar ExifTool de manera efectiva, debe saber c칩mo PowerShell inicia los archivos `.exe` externos.
La forma correcta y m치s confiable de ejecutar programas externos es el **operador de llamada `&` (ampersand)**.
PowerShell generar치 un error si la ruta del programa contiene espacios. Por ejemplo, `C:\My Tools\exiftool.exe`.
`&` (ampersand) le dice a PowerShell: "El texto que me sigue entre comillas es la ruta al archivo ejecutable. Ejec칰telo, y todo lo que sigue son sus argumentos".

```powershell
# Sintaxis correcta
& "C:\Path With Spaces\program.exe" "argument 1" "argument 2"
```

Siempre use `&` cuando trabaje con rutas de programas en variables o rutas que puedan contener espacios.

---

## Trucos pr치cticos: ExifTool + PowerShell

Ahora, combinemos nuestros conocimientos.

### Ejemplo #1: Extracci칩n b치sica y visualizaci칩n interactiva

La forma m치s sencilla de obtener todos los datos de una foto y examinarlos es solicitarlos en formato JSON y pasarlos a `Out-ConsoleGridView`.

```powershell
$photoPath = "D:\Photos\IMG_1234.JPG"

# 1. Ejecutar exiftool con la opci칩n -json para una salida estructurada
# 2. Convertir el texto JSON a un objeto PowerShell
#    Llamar a exiftool.exe directamente, sin una variable y el operador de llamada &.
$exifObject = exiftool.exe -json $photoPath | ConvertFrom-Json

# 3. Transformar el objeto "ancho" en una tabla conveniente "Par치metro-Valor"
$reportData = $exifObject.psobject.Properties | Select-Object Name, Value

# 4. Mostrar el resultado en una ventana interactiva para an치lisis
$reportData | Out-ConsoleGridView -Title "Metadatos del archivo: $($photoPath | Split-Path -Leaf)"
```

Este c칩digo abrir치 una ventana interactiva donde podr치 ordenar los datos por nombre de par치metro o valor, y filtrarlos simplemente comenzando a escribir texto. Esto es incre칤blemente conveniente para encontrar r치pidamente la informaci칩n necesaria.

### Ejemplo #2: Creaci칩n de un informe limpio y env칤o a diferentes "dispositivos"

`Out-ConsoleGridView` es solo el comienzo. Puede dirigir los datos procesados a cualquier lugar utilizando otros cmdlets `Out-*`.

Supongamos que tenemos datos en la variable `$reportData` del ejemplo anterior.

#### **A) Env칤o a un archivo CSV para Excel**
```powershell
$reportData | Export-Csv -Path "C:\Reports\photo_exif.csv" -NoTypeInformation -Encoding UTF8
```
El comando `Export-Csv` crea un archivo perfectamente estructurado que se puede abrir en Excel o Google Sheets.

#### **B) Env칤o a un archivo de texto**
```powershell
# Para un formato agradable, use primero Format-Table
$reportData | Format-Table -AutoSize | Out-File -FilePath "C:\Reports\photo_exif.txt"
```
El comando `Out-File` guardar치 en un archivo una copia de texto exacta de lo que ve en la consola.

#### **C) Env칤o al portapapeles**
쯈uiere pegar datos r치pidamente en un correo electr칩nico o chat? Use `Out-Clipboard`.
```powershell
$reportData | Format-Table -AutoSize | Out-String | Out-Clipboard
```

Ahora puede presionar `Ctrl+V` en cualquier editor de texto y pegar una tabla cuidadosamente formateada.

### Ejemplo #3: Obtenci칩n de datos espec칤ficos para usar en un script

Con frecuencia, no necesita el informe completo, sino solo uno o dos valores. Dado que `$exifObject` es un objeto PowerShell regular, puede acceder f치cilmente a sus propiedades.

```powershell

$photoPath = "D:\Photos\IMG_1234.JPG"

# Llamar a exiftool.exe directamente por su nombre.
# PowerShell lo encontrar치 autom치ticamente en una de las carpetas listadas en PATH.
$exifObject = exiftool.exe -json $photoPath | ConvertFrom-Json

# 1. Crear un objeto PowerShell con nombres de propiedades comprensibles.
#    Esto es similar a crear un registro estructurado.
$reportObject = [PSCustomObject]@{ 
    "C치mara"           = $exifObject.Model
    "Fecha de toma"      = $exifObject.DateTimeOriginal
    "Sensibilidad" = $exifObject.ISO
    "Nombre de archivo"        = $exifObject.FileName # Agregar nombre de archivo para el contexto
}

# 2. Mostrar este objeto en una ventana interactiva.
#    Out-GridView crear치 autom치ticamente columnas a partir de los nombres de las propiedades.
$reportObject | Out-ConsoleGridView -Title "Metadatos del archivo: $(Split-Path $photoPath -Leaf)"
```

Este enfoque es la base para cualquier automatizaci칩n seria, como renombrar archivos seg칰n la fecha de toma, ordenar fotos por modelo de c치mara o agregar marcas de agua con informaci칩n de exposici칩n.

### Ejemplo #4: Extracci칩n por lotes de metadatos de una carpeta

A veces es necesario analizar no una sola foto, sino una carpeta completa de im치genes.

```powershell
# Especificar solo la carpeta de fotos.
$photoFolder = "D:\Photos"

# Llamar a exiftool.exe directamente. No se necesitan variables para la ruta ni el operador &.
$allExif = exiftool.exe -json "$photoFolder\*.jpg" | ConvertFrom-Json

# Transformar a una vista conveniente 
$report = foreach ($photo in $allExif) {
    [PSCustomObject]@{ 
        # --- Datos b치sicos del archivo y la c치mara ---
        FileName       = $photo.FileName
        DateTime       = $photo.DateTimeOriginal
        CameraMake     = $photo.Make                 # Fabricante (por ejemplo, "Canon", "SONY")
        CameraModel    = $photo.Model                 # Modelo de c치mara (por ejemplo, "EOS R5")
        LensModel      = $photo.LensID                # Nombre completo del modelo de lente
        
        # --- Par치metros de disparo (exposici칩n) ---
        ISO            = $photo.ISO
        ShutterSpeed   = $photo.ShutterSpeed
        Aperture       = $photo.Aperture
        FocalLength    = $photo.FocalLength           # Distancia focal (por ejemplo, "50.0 mm")
        ExposureMode   = $photo.ExposureProgram       # Modo de disparo (por ejemplo, "Manual", "Prioridad de apertura")
        Flash          = $photo.Flash                 # Informaci칩n sobre si el flash se dispar칩
        
        # --- GPS y datos de imagen ---
        GPSPosition    = $photo.GPSPosition           # Coordenadas GPS como una sola cadena (si est치n disponibles)
        Dimensions     = "$($photo.ImageWidth)x$($photo.ImageHeight)" # Dimensiones de la imagen en p칤xeles
    }
}

# Mostrar datos en una tabla interactiva en la CONSOLA
$report | Out-ConsoleGridView -Title "Informe resumido para la carpeta: $photoFolder"
```

游눠 Obtiene una tabla ordenada para toda la carpeta a la vez.

---

### Ejemplo #5: B칰squeda recursiva en subcarpetas

ExifTool puede buscar archivos en todas las subcarpetas por s칤 mismo usando la opci칩n `-r`.

```powershell
& $exifToolPath -r -json "D:\Photos" | ConvertFrom-Json |\
    Select-Object FileName, Model, DateTimeOriginal |\
    Export-Csv "C:\Reports\all_photos_recursive.csv" -NoTypeInformation -Encoding UTF8
```

---

### Ejemplo #6: Renombrar archivos por fecha de toma

Este es uno de los escenarios de automatizaci칩n m치s populares: los archivos se nombran por la fecha/hora en que fueron tomados.

```powershell
$exifToolPath = "C:\Tools\exiftool.exe"
$photoFolder = "D:\Photos"

# Renombrar al formato AAAA-MM-DD_HH-MM-SS.jpg
& $exifToolPath -r -d "%Y-%m-%d_%H-%M-%S.%%e" "-FileName<DateTimeOriginal" $photoFolder
```

游눠 *ExifTool insertar치 autom치ticamente la extensi칩n del archivo original a trav칠s de `%%e`.*

---

### Ejemplo #7: Extracci칩n solo de coordenadas GPS

칔til si desea construir un mapa a partir de sus fotos.

```powershell
# 1. Especifique la ruta a la carpeta con sus fotos
$photoFolder = "E:\DCIM\Camera"

# 2. Liste las etiquetas que necesitamos: nombre de archivo y tres etiquetas GPS.
#    Esto hace que la consulta sea mucho m치s r치pida que si estuvi칠ramos recuperando todas las etiquetas.
$tagsToExtract = @(
    "-SourceFile", # SourceFile es mejor que FileName, ya que generalmente contiene la ruta completa
    "-GPSLatitude",
    "-GPSLongitude",
    "-GPSAltitude"
)

# 3. Llamar a exiftool.exe directamente (ya que est치 en PATH).
#    La opci칩n -r busca archivos en todas las subcarpetas.
#    El resultado se convierte inmediatamente de JSON.
$allExifData = exiftool.exe -r -json $tagsToExtract $photoFolder | ConvertFrom-Json

# 4. Filtrar los resultados: mantener S칍LO aquellos objetos que tienen latitud y longitud.
$filesWithGps = $allExifData | Where-Object { $_.GPSLatitude -and $_.GPSLongitude }

# 5. Comprobar si se encontraron archivos con datos GPS
if ($filesWithGps) {
    # 6. Crear un informe agradable a partir de los datos filtrados.
    #    Usar Select-Object para renombrar columnas y formatear.
    $report = $filesWithGps | Select-Object @{Name="Nombre de archivo"; Expression={Split-Path $_.SourceFile -Leaf}},
                                             @{Name="Latitud"; Expression={$_.GPSLatitude}},
                                             @{Name="Longitud"; Expression={$_.GPSLongitude}},
                                             @{Name="Altitud"; Expression={if ($_.GPSAltitude) { "$($_.GPSAltitude) m" } else { "N/A" }}}
    
    # 7. Mostrar el informe final en una tabla de consola interactiva.
    $report | Out-ConsoleGridView -Title "Archivos con datos GPS en la carpeta: $photoFolder"

} else {
    # Si no se encuentra nada, informar amablemente al usuario.
    Write-Host "Archivos con datos GPS en la carpeta '$photoFolder' no encontrados." -ForegroundColor Yellow
}
```

---

### Ejemplo #8: Eliminaci칩n masiva de todos los datos GPS (para privacidad)

```powershell
# Eliminar todas las etiquetas GPS de JPG y PNG
& $exifToolPath -r -overwrite_original -gps:all= "D:\Photos"
```

游눠 *Esta acci칩n es irreversible, as칤 que haga una copia de seguridad antes de ejecutar.*

---

### Ejemplo #9: Convertir la hora de toma a la hora local

A veces, las fotos se toman en una zona horaria diferente. ExifTool puede cambiar la fecha.

```powershell
# Cambiar la hora en +3 horas
& $exifToolPath "-AllDates+=3:0:0" "D:\Photos\IMG_*.JPG"
```

---

### Ejemplo #10: Obtener una lista de todos los modelos de c치mara 칰nicos en una carpeta

```powershell
$models = & $exifToolPath -r -Model -s3 "D:\Photos" | Sort-Object -Unique
$models | ForEach-Object { Write-Host "Modelo: $_" }
```

---

### Ejemplo #11: Mostrar solo las etiquetas necesarias en formato tabular

```powershell
& $exifToolPath -T -Model -DateTimeOriginal -ISO -Aperture -ShutterSpeed "D:\Photos\IMG_1234.JPG"
```

`-T` muestra la salida en formato tabular, separada por tabulaciones, lo que es conveniente para un procesamiento posterior.

---

### Ejemplo #12: Comprobar la presencia de GPS en una gran cantidad de archivos

```powershell
$files = & $exifToolPath -r -if "$gpslatitude" -p '$FileName' "D:\Photos"
Write-Host "Archivos con GPS:"
$files
```

---

### Ejemplo #13: Copiar metadatos de un archivo a otro

```powershell
# 1. Seleccionar el archivo de referencia
$sourceFile = Get-ChildItem "D:\Photos" -Filter "*.jpg" | Out-ConsoleGridView -Title "Seleccionar archivo de REFERENCIA"

# 2. Si se selecciona una referencia, seleccionar los archivos de destino
if ($sourceFile) {
    $targetFiles = Get-ChildItem "D:\Photos\New" -Filter "*.jpg" | Out-ConsoleGridView -Title "Seleccionar archivos de DESTINO para copiar metadatos" -OutputMode Multiple
    
    # 3. Si se seleccionan los destinos, realizar la copia
    if ($targetFiles) {
        & exiftool.exe -TagsFromFile $sourceFile.FullName ($targetFiles.FullName)
        Write-Host "Metadatos copiados de $($sourceFile.Name) a $($targetFiles.Count) archivos."
    }
}
```

---

### Ejemplo #14: Guardar metadatos originales en un JSON separado antes de la modificaci칩n

```powershell
$backupPath = "C:\Reports\metadata_backup.json"
& $exifToolPath -r -json "D:\Photos" | Out-File -Encoding UTF8 $backupPath
```

---

### Ejemplo #15: Usar PowerShell para la clasificaci칩n autom치tica de fotos por fecha

```powershell
$photos = Get-ChildItem "D:\Photos" -Filter *.jpg -Recurse
foreach ($photo in $photos) {
    $meta = & $exifToolPath -json $photo.FullName | ConvertFrom-Json
    $date = Get-Date $meta.DateTimeOriginal -ErrorAction SilentlyContinue
    if ($date) {
        $targetFolder = "D:\Sorted\{0:yyyy}\{0:MM}" -f $date
        if (-not (Test-Path $targetFolder)) { New-Item -Path $targetFolder -ItemType Directory }
        Move-Item $photo.FullName -Destination $targetFolder
    }
}
```

---

<h3>Ejemplo 16: Encontrar todos los modelos de c치mara 칰nicos en una colecci칩n</h3>
<p>Aunque esto se puede hacer en una sola l칤nea, la salida a <code>GridView</code> le permite copiar inmediatamente el nombre del modelo deseado.</p>
<pre class="line-numbers"><code class="language-powershell"># La opci칩n -s3 muestra solo los valores, -Model - el nombre de la etiqueta
$uniqueModels = &amp; exiftool.exe -r -Model -s3 "D:\Photos" | Sort-Object -Unique

# Mostrar en GridView para una visualizaci칩n y copia f치ciles
$uniqueModels | Out-ConsoleGridView -Title "Modelos de c치mara 칰nicos en la colecci칩n"
</code></pre>