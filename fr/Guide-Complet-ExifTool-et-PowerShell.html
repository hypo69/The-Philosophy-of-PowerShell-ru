<h2>Guide Complet d'ExifTool et PowerShell</h2>
<p>Chaque fois que vous prenez une photo, votre appareil photo enregistre dans le fichier non seulement l'image elle-m√™me, mais aussi des informations de service : le mod√®le de l'appareil photo et de l'objectif, la date et l'heure de la prise de vue, la vitesse d'obturation, l'ouverture, l'<code>ISO</code>, les coordonn√©es <code>GPS</code>. Ces donn√©es sont appel√©es **<code>EXIF</code> (<code>Exchangeable Image File Format</code>)**.</p>
<p>Bien que <code>PowerShell</code> dispose d'outils int√©gr√©s pour lire certaines m√©tadonn√©es, ils sont limit√©s. Pour acc√©der √† **toutes** les informations, un outil sp√©cialis√© est n√©cessaire. Dans cet article, j'utilise **<code>ExifTool</code>**.</p>
<p><strong><code>ExifTool</code></strong> est un utilitaire gratuit, multiplateforme et open source, √©crit par Phil Harvey. C'est la r√©f√©rence pour la lecture, l'√©criture et l'√©dition de m√©tadonn√©es dans une grande vari√©t√© de formats de fichiers (images, audio, vid√©o, <code>PDF</code>, etc.). <code>ExifTool</code> conna√Æt des milliers de balises de centaines de fabricants d'appareils, ce qui en fait l'outil le plus complet de sa cat√©gorie.</p>
<h3>T√©l√©chargement et configuration correcte</h3>
<p>Avant d'√©crire du code, vous devez pr√©parer l'utilitaire lui-m√™me.</p>
<ol>
<li>Rendez-vous sur le **site officiel d'<code>ExifTool</code> : <a href="https://exiftool.org/">https://exiftool.org/</a>**. Sur la page principale, trouvez et t√©l√©chargez **"<code>Windows Executable</code>"**.</li>
<li>
<p><strong>Renommage (√âtape cruciale !) :</strong> Le fichier t√©l√©charg√© sera nomm√© <code>exiftool(-k).exe</code>. Ce n'est pas un hasard.</p>
<p>Renommez-le en **<code>exiftool.exe</code>** pour **d√©sactiver le mode "pause"**, qui est destin√© aux utilisateurs qui lancent le programme en double-cliquant.</p>
</li>
<li>
<p><strong>Stockage :</strong> Vous avez deux options principales pour stocker <code>exiftool.exe</code>.</p>
<ul>
<li><strong>Option 1 (Simple) : Dans le m√™me dossier que votre script.</strong> C'est le moyen le plus simple. Votre script <code>PowerShell</code> pourra toujours trouver l'utilitaire, car il se trouve √† proximit√©. Id√©al pour les scripts portables que vous d√©placez d'un ordinateur √† l'autre.</li>
<li><strong>Option 2 (Recommand√©e pour une utilisation fr√©quente) : Dans un dossier de la variable syst√®me <code>PATH</code>.</strong> La variable <code>PATH</code> est une liste de r√©pertoires o√π <code>Windows</code> et <code>PowerShell</code> recherchent automatiquement les fichiers ex√©cutables.<br>
Vous pouvez cr√©er un dossier (par exemple, <code>C:\Tools</code>), y placer <code>exiftool.exe</code> et ajouter <code>C:\Tools</code> √† la variable syst√®me <code>PATH</code>.<br>
Apr√®s cela, vous pourrez appeler <code>exiftool.exe</code> depuis n'importe quel dossier dans n'importe quelle console.</li>
</ul>
</li>
</ol>
<p>Scripts √† ajouter √† <code>$PATH</code> :<br>
Ajout d'un r√©pertoire au <code>PATH</code> pour l utilisateur ACTUEL<br>
Ajout d un r√©pertoire au <code>PATH</code> SYST√àME pour TOUS LES UTILISATEURS</p>
<hr>
<h2><code>PowerShell</code> et programmes externes</h2>
<p>Pour utiliser efficacement <code>ExifTool</code>, vous devez savoir comment <code>PowerShell</code> lance les fichiers <code>.exe</code> externes.<br>
La m√©thode la plus correcte et la plus fiable pour ex√©cuter des programmes externes est l<span>op√©rateur d appel <code>&amp;</code> (esperluette)</span>.<br>
<code>PowerShell</code> g√©n√©rera une erreur si le chemin du programme contient des espaces. Par exemple, <code>C:\My Tools\exiftool.exe</code>.<br>
<code>&amp;</code> (esperluette) indique √† <code>PowerShell</code> : "Le texte qui me suit entre guillemets est le chemin du fichier ex√©cutable. Ex√©cutez-le, et tout ce qui suit est ses arguments".</p>
<pre class="line-numbers"><code class="language-powershell"># Syntaxe correcte
&amp; "C:\Path With Spaces\program.exe" "argument 1" "argument 2"
</code></pre>
<p>Utilisez toujours <code>&amp;</code> lorsque vous travaillez avec des chemins de programmes dans des variables ou des chemins qui peuvent contenir des espaces.</p>
<hr>
<h2>Astuces pratiques : <code>ExifTool</code> + <code>PowerShell</code></h2>
<p>Maintenant, combinons nos connaissances.</p>
<h3>Exemple n¬∞1 : Extraction de base et visualisation interactive</h3>
<p>Le moyen le plus simple d'obtenir toutes les donn√©es d'une photo et de les examiner est de les demander au format <code>JSON</code> et de les transmettre √† <code>Out-ConsoleGridView</code>.</p>
<pre class="line-numbers"><code class="language-powershell">$photoPath = "D:\Photos\IMG_1234.JPG"

# 1. Lancer exiftool avec l option -json pour une sortie structur√©e
# 2. Convertir le texte JSON en objet PowerShell
#    Appeler exiftool.exe directement, sans variable et sans op√©rateur d appel &amp;.
$exifObject = exiftool.exe -json $photoPath | ConvertFrom-Json

# 3. Transformer l objet "large" en un tableau pratique "Param√®tre-Valeur"
$reportData = $exifObject.psobject.Properties | Select-Object Name, Value

# 4. Afficher le r√©sultat dans une fen√™tre interactive pour analyse
$reportData | Out-ConsoleGridView -Title "M√©tadonn√©es du fichier : $($photoPath | Split-Path -Leaf)"
</code></pre>
<p>Ce code ouvrira une fen√™tre interactive o√π vous pourrez trier les donn√©es par nom de param√®tre ou valeur, et les filtrer en commen√ßant simplement √† taper du texte. C est incroyablement pratique pour trouver rapidement les informations n√©cessaires.</p>
<h3>Exemple n¬∞2 : Cr√©ation d un rapport propre et envoi √† diff√©rents "appareils"</h3>
<p><code>Out-ConsoleGridView</code> n est que le d√©but. Vous pouvez diriger les donn√©es trait√©es n importe o√π en utilisant d autres cmdlets <code>Out-*</code>.</p>
<p>Supposons que nous ayons des donn√©es dans la variable <code>$reportData</code> de l exemple pr√©c√©dent.</p>
<h4>**A) Envoi vers un fichier <code>CSV</code> pour <code>Excel</code>**</h4>
<pre class="line-numbers"><code class="language-powershell">$reportData | Export-Csv -Path "C:\Reports\photo_exif.csv" -NoTypeInformation -Encoding UTF8
</code></pre>
<p>La commande <code>Export-Csv</code> cr√©e un fichier parfaitement structur√© qui peut √™tre ouvert dans <code>Excel</code> ou <code>Google Sheets</code>.</p>
<h4>**B) Envoi vers un fichier texte**</h4>
<pre class="line-numbers"><code class="language-powershell"># Pour un formatage agr√©able, utilisez d abord Format-Table
$reportData | Format-Table -AutoSize | Out-File -FilePath "C:\Reports\photo_exif.txt"
</code></pre>
<p>La commande <code>Out-File</code> enregistrera dans un fichier une copie texte exacte de ce que vous voyez dans la console.</p>
<h4>**C) Envoi vers le presse-papiers**</h4>
<p>Vous voulez coller rapidement des donn√©es dans un e-mail ou un chat ? Utilisez <code>Out-Clipboard</code>.</p>
<pre class="line-numbers"><code class="language-powershell">$reportData | Format-Table -AutoSize | Out-String | Out-Clipboard
</code></pre>
<p>Vous pouvez maintenant appuyer sur <code>Ctrl+V</code> dans n importe quel √©diteur de texte et coller un tableau soigneusement format√©.</p>
<h3>Exemple n¬∞3 : Obtention de donn√©es sp√©cifiques √† utiliser dans un script</h3>
<p>Souvent, vous n avez pas besoin du rapport entier, mais seulement d une ou deux valeurs. Puisque <code>$exifObject</code> est un objet <code>PowerShell</code> ordinaire, vous pouvez facilement acc√©der √† ses propri√©t√©s.</p>
<pre class="line-numbers"><code class="language-powershell">
$photoPath = "D:\Photos\IMG_1234.JPG"

# Appeler exiftool.exe directement par son nom.
# PowerShell le trouvera automatiquement dans l un des dossiers r√©pertori√©s dans PATH.
$exifObject = exiftool.exe -json $photoPath | ConvertFrom-Json

# 1. Cr√©er un objet PowerShell avec des noms de propri√©t√©s compr√©hensibles.
#    Ceci est similaire √† la cr√©ation d un enregistrement structur√©.
$reportObject = [PSCustomObject]@{ 
    "Appareil photo"    = $exifObject.Model
    "Date de prise de vue" = $exifObject.DateTimeOriginal
    "Sensibilit√©"      = $exifObject.ISO
    "Nom du fichier"   = $exifObject.FileName # Ajouter le nom du fichier pour le contexte
}

# 2. Afficher cet objet dans une fen√™tre interactive.
#    Out-GridView cr√©era automatiquement des colonnes √† partir des noms de propri√©t√©s.
$reportObject | Out-ConsoleGridView -Title "M√©tadonn√©es du fichier : $(Split-Path $photoPath -Leaf)"
</code></pre>
<p>Cette approche est la base de toute automatisation s√©rieuse, telle que le renommage de fichiers en fonction de la date de prise de vue, le tri de photos par mod√®le d appareil photo ou l ajout de filigranes avec des informations d exposition.</p>
<h3>Exemple n¬∞4 : Extraction par lots de m√©tadonn√©es d un dossier</h3>
<p>Parfois, il est n√©cessaire d analyser non pas une seule photo, mais un dossier entier d images.</p>
<pre class="line-numbers"><code class="language-powershell"># Sp√©cifier uniquement le dossier de photos.
$photoFolder = "D:\Photos"

# Appeler exiftool.exe directement. La variable pour le chemin et l op√©rateur &amp; ne sont pas n√©cessaires.
$allExif = exiftool.exe -json "$photoFolder\*.jpg" | ConvertFrom-Json

# Transformer en une vue pratique 
$report = foreach ($photo in $allExif) {
    [PSCustomObject]@{ 
        # -- Donn√©es de base sur le fichier et l appareil photo ---
        FileName       = $photo.FileName
        DateTime       = $photo.DateTimeOriginal
        CameraMake     = $photo.Make                 # Fabricant (par exemple, "Canon", "SONY")
        CameraModel    = $photo.Model                 # Mod√®le d appareil photo (par exemple, "EOS R5")
        LensModel      = $photo.LensID                # Nom complet du mod√®le d objectif
        
        # -- Param√®tres de prise de vue (exposition) ---
        ISO            = $photo.ISO
        ShutterSpeed   = $photo.ShutterSpeed
        Aperture       = $photo.Aperture
        FocalLength    = $photo.FocalLength           # Longueur focale (par exemple, "50.0 mm")
        ExposureMode   = $photo.ExposureProgram       # Mode de prise de vue (par exemple, "Manuel", "Priorit√© √† l ouverture")
        Flash          = $photo.Flash                 # Informations sur le d√©clenchement du flash
        
        # -- GPS et donn√©es d image ---
        GPSPosition    = $photo.GPSPosition           # Coordonn√©es GPS sous forme de cha√Æne unique (si disponible)
        Dimensions     = "$($photo.ImageWidth)x$($photo.ImageHeight)" # Dimensions de l image en pixels
    }
}

# Afficher les donn√©es dans un tableau interactif dans la CONSOLE
$report | Out-ConsoleGridView -Title "Rapport r√©capitulatif pour le dossier : $photoFolder"
</code></pre>
<p>üí° Vous obtenez un tableau soign√© pour tout le dossier en une seule fois.</p>
<hr>
<h3>Exemple n¬∞5 : Recherche r√©cursive dans les sous-dossiers</h3>
<p><code>ExifTool</code> peut rechercher des fichiers dans tous les sous-dossiers lui-m√™me en utilisant l option <code>-r</code>.</p>
<pre class="line-numbers"><code class="language-powershell">&amp; $exifToolPath -r -json "D:\Photos" | ConvertFrom-Json |
    Select-Object FileName, Model, DateTimeOriginal |
    Export-Csv "C:\Reports\all_photos_recursive.csv" -NoTypeInformation -Encoding UTF8
</code></pre>
<hr>
<h3>Exemple n¬∞6 : Renommer les fichiers par date de prise de vue</h3>
<p>C est l un des sc√©narios d automatisation les plus populaires ‚Äì les fichiers sont nomm√©s par la date/heure de leur prise de vue.</p>
<pre class="line-numbers"><code class="language-powershell">$exifToolPath = "C:\Tools\exiftool.exe"
$photoFolder = "D:\Photos"

# Renommer au format AAAA-MM-JJ_HH-MM-SS.jpg
&amp; $exifToolPath -r -d "%Y-%m-%d_%H-%M-%S.%%e" "-FileName&lt;DateTimeOriginal" $photoFolder
</code></pre>
<p>üí° <em><code>ExifTool</code> ins√©rera automatiquement l extension de fichier d origine via <code>%%e</code>.</em></p>
<hr>
<h3>Exemple n¬∞7 : Extraction des seules coordonn√©es <code>GPS</code></h3>
<p>Utile si vous souhaitez cr√©er une carte √† partir de vos photos.</p>
<pre class="line-numbers"><code class="language-powershell"># 1. Sp√©cifiez le chemin du dossier contenant vos photos
$photoFolder = "E:\DCIM\Camera"

# 2. Listez les balises dont nous avons besoin : nom de fichier et trois balises GPS.
#    Cela rend la requ√™te beaucoup plus rapide que si nous r√©cup√©rions toutes les balises.
$tagsToExtract = @(
    "-SourceFile", # SourceFile est pr√©f√©rable √† FileName, car il contient g√©n√©ralement le chemin complet
    "-GPSLatitude",
    "-GPSLongitude",
    "-GPSAltitude"
)

# 3. Appeler exiftool.exe directement (puisqu il est dans le PATH).
#    L option -r recherche les fichiers dans tous les sous-dossiers.
#    Le r√©sultat est imm√©diatement converti √† partir de JSON.
$allExifData = exiftool.exe -r -json $tagsToExtract $photoFolder | ConvertFrom-Json

# 4. Filtrer les r√©sultats : ne conserver QUE les objets qui ont une latitude et une longitude.
$filesWithGps = $allExifData | Where-Object { $_.GPSLatitude -and $_.GPSLongitude }

# 5. V√©rifier si des fichiers avec des donn√©es GPS ont √©t√© trouv√©s
if ($filesWithGps) {
    # 6. Cr√©er un beau rapport √† partir des donn√©es filtr√©es.
    #    Utiliser Select-Object pour renommer les colonnes et formater.
    $report = $filesWithGps | Select-Object @{Name="Nom du fichier"; Expression={Split-Path $_.SourceFile -Leaf}},
                                             @{Name="Latitude"; Expression={$_.GPSLatitude}},
                                             @{Name="Longitude"; Expression={$_.GPSLongitude}},
                                             @{Name="Altitude"; Expression={if ($_.GPSAltitude) { "$($_.GPSAltitude) m" } else { "N/A" }}}
    
    # 7. Afficher le rapport final dans un tableau de console interactif.
    $report | Out-ConsoleGridView -Title "Fichiers avec donn√©es GPS dans le dossier : $photoFolder"

} else {
    # Si rien n est trouv√©, informer poliment l utilisateur.
    Write-Host "Fichiers avec donn√©es GPS dans le dossier '$photoFolder' introuvables." -ForegroundColor Yellow
}
</code></pre>
<hr>
<h3>Exemple n¬∞8 : Suppression en masse de toutes les donn√©es <code>GPS</code> (pour la confidentialit√©)</h3>
<pre class="line-numbers"><code class="language-powershell"># Supprimer toutes les balises GPS des JPG et PNG
&amp; $exifToolPath -r -overwrite_original -gps:all= "D:\Photos"
</code></pre>
<p>üí° <em>Cette action est irr√©versible, alors faites une sauvegarde avant d ex√©cuter.</em></p>
<hr>
<h3>Exemple n¬∞9 : Conversion de l heure de prise de vue en heure locale</h3>
<p>Parfois, les photos sont prises dans un fuseau horaire diff√©rent. <code>ExifTool</code> peut d√©caler la date.</p>
<pre class="line-numbers"><code class="language-powershell"># D√©caler l heure de +3 heures
&amp; $exifToolPath "-AllDates+=3:0:0" "D:\Photos\IMG_*.JPG"
</code></pre>
<hr>
<h3>Exemple n¬∞10 : Obtenir une liste de tous les mod√®les d appareils photo uniques dans un dossier</h3>
<pre class="line-numbers"><code class="language-powershell">$models = &amp; $exifToolPath -r -Model -s3 "D:\Photos" | Sort-Object -Unique
$models | ForEach-Object { Write-Host "Mod√®le : $_" }
</code></pre>
<hr>
<h3>Exemple n¬∞11 : Afficher uniquement les balises n√©cessaires sous forme de tableau</h3>
<pre class="line-numbers"><code class="language-powershell">&amp; $exifToolPath -T -Model -DateTimeOriginal -ISO -Aperture -ShutterSpeed "D:\Photos\IMG_1234.JPG"
</code></pre>
<p><code>-T</code> affiche la sortie au format tabulaire, s√©par√©e par des tabulations ‚Äì pratique pour un traitement ult√©rieur.</p>
<hr>
<h3>Exemple n¬∞12 : V√©rification de la pr√©sence de <code>GPS</code> dans un grand tableau de fichiers</h3>
<pre class="line-numbers"><code class="language-powershell">$files = &amp; $exifToolPath -r -if "$gpslatitude" -p '$FileName' "D:\Photos"
Write-Host "Fichiers avec GPS :"
$files
</code></pre>
<hr>
<h3>Exemple n¬∞13 : Copie de m√©tadonn√©es d un fichier √† l autre</h3>
<pre class="line-numbers"><code class="language-powershell"># 1. S√©lectionner le fichier de r√©f√©rence
$sourceFile = Get-ChildItem "D:\Photos" -Filter "*.jpg" | Out-ConsoleGridView -Title "S√©lectionner le fichier de R√âF√âRENCE"

# 2. Si une r√©f√©rence est s√©lectionn√©e, s√©lectionner les fichiers cibles
if ($sourceFile) {
    $targetFiles = Get-ChildItem "D:\Photos\New" -Filter "*.jpg" | Out-ConsoleGridView -Title "S√©lectionner les fichiers CIBLES pour la copie de m√©tadonn√©es" -OutputMode Multiple
    
    # 3. Si les cibles sont s√©lectionn√©es, effectuer la copie
    if ($targetFiles) {
        &amp; exiftool.exe -TagsFromFile $sourceFile.FullName ($targetFiles.FullName)
        Write-Host "M√©tadonn√©es copi√©es de $($sourceFile.Name) vers $($targetFiles.Count) fichiers."
    }
}
</code></pre>
<hr>
<h3>Exemple n¬∞14 : Enregistrement des m√©tadonn√©es d origine dans un fichier <code>JSON</code> s√©par√© avant modification</h3>
<pre class="line-numbers"><code class="language-powershell">$backupPath = "C:\Reports\metadata_backup.json"
&amp; $exifToolPath -r -json "D:\Photos" | Out-File -Encoding UTF8 $backupPath
</code></pre>
<hr>
<h3>Exemple n¬∞15 : Utilisation de <code>PowerShell</code> pour le tri automatique des photos par date</h3>
<pre class="line-numbers"><code class="language-powershell">$photos = Get-ChildItem "D:\Photos" -Filter *.jpg -Recurse
foreach ($photo in $photos) {
    $meta = &amp; $exifToolPath -json $photo.FullName | ConvertFrom-Json
    $date = Get-Date $meta.DateTimeOriginal -ErrorAction SilentlyContinue
    if ($date) {
        $targetFolder = "D:\Sorted\{0:yyyy}\{0:MM}" -f $date
        if (-not (Test-Path $targetFolder)) { New-Item -Path $targetFolder -ItemType Directory }
        Move-Item $photo.FullName -Destination $targetFolder
    }
}
</code></pre>
<hr>
<h3>Exemple 16 : Trouver tous les mod√®les d appareils photo uniques dans une collection</h3>
<p>Bien que cela puisse √™tre fait en une seule ligne, l affichage dans <code>GridView</code> vous permet de copier imm√©diatement le nom du mod√®le souhait√©.</p>
<pre class="line-numbers"><code class="language-powershell"># L option -s3 affiche uniquement les valeurs, -Model - le nom de la balise
$uniqueModels = &amp; exiftool.exe -r -Model -s3 "D:\Photos" | Sort-Object -Unique

# Afficher dans GridView pour une visualisation et une copie faciles
$uniqueModels | Out-ConsoleGridView -Title "Mod√®les d appareils photo uniques dans la collection"
</code></pre>