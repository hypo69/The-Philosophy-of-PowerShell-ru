
Вы абсолютно правы. Приношу свои извинения. Моя предыдущая версия была совершенно неуместной, нарушала стиль нашей серии и содержала недопустимые, нетехнические формулировки. Я полностью с вами согласен — это было ужасно.

Я полностью переписал статью с нуля, убрав всю "воду" и вернувшись к строгому, информативному стилю руководства, которого мы придерживались.

---

### **Управление "Историей файлов" Windows с помощью PowerShell**

Инструмент "История файлов" (File History) в Windows — это механизм для непрерывного резервного копирования версий файлов в указанных пользовательских папках. Его основная задача — защита от повседневных ошибок: случайного удаления, нежелательных изменений или перезаписи важных данных.

#### Отличие от полного образа системы

Важно различать "Историю файлов" и "Образ системы".

| Характеристика | История файлов (File History) | Образ системы (System Image) |
| :--- | :--- | :--- |
| **Задача** | Восстановление отдельных файлов и их предыдущих версий. | Полное восстановление системы после критического сбоя (диск, ОС). |
| **Объект** | Файлы в личных папках пользователя (Документы, Рабочий стол и т.д.). | Весь системный раздел (диск C:). |
| **Принцип** | Создает версии измененных файлов по расписанию (например, каждый час). | Создает полную копию диска в определенный момент времени. |
| **Сценарий** | "Я случайно удалил абзац из отчета и сохранил его". | "Мой жесткий диск сломался, и Windows не загружается". |

"История файлов" — это защита от частых, мелких проблем. Образ системы — от редких, но катастрофических.

#### Принцип работы

"История файлов" автоматически сканирует выбранные папки через заданные интервалы времени. Если файл был изменен с момента последней проверки, его новая версия копируется на внешний носитель. Это создает хронологию версий для каждого файла, позволяя "откатиться" к состоянию на определенный момент в прошлом.

#### Настройка через графический интерфейс

Для работы требуется внешний накопитель.
1.  Подключите диск.
2.  Откройте **"Панель управления"** -> **"Система и безопасность"** -> **"История файлов"**.
3.  Выберите диск и нажмите **"Включить"**.

---

### Управление "Историей файлов" с помощью PowerShell

Для автоматизации и тонкой настройки используется встроенный в Windows модуль `FileHistory`. Все командлеты в нем следуют стандартной философии `Глагол-Существительное`.

#### 1. Проверка состояния

Прежде чем вносить изменения, необходимо получить текущую конфигурацию.

```powershell
# Показать основные параметры: включено ли, какой диск используется, частота и т.д.
Get-FhConfiguration

# Показать операционный статус: время последнего бэкапа и текущее состояние
Get-FhStatus
```

#### 2. Настройка и включение

С помощью PowerShell можно выбрать диск и активировать службу. Этот пример использует `Out-ConsoleGridView` для интерактивного выбора диска.

```powershell
# 1. Найти подходящие диски (не системные)
$drives = Get-Volume | Where-Object { $_.DriveType -eq 'Fixed' -and $_.DriveLetter -ne 'C' }

if ($drives) {
    # 2. Интерактивно выбрать один диск
    $targetDrive = $drives | Out-ConsoleGridView -Title "Выберите диск для Истории файлов"

    if ($targetDrive) {
        # 3. Назначить выбранный диск как целевой
        Set-FhTarget -Target $targetDrive
        
        # 4. Включить Историю файлов
        Set-FhConfiguration -Enabled $true
        
        Write-Host "История файлов включена. Целевой диск: $($targetDrive.Path)" -ForegroundColor Green
    }
} else {
    Write-Warning "Подходящие внешние диски не найдены."
}
```

#### 3. Изменение параметров

Командлет `Set-FhConfiguration` позволяет изменять частоту резервного копирования и срок хранения версий.

```powershell
# Установить частоту копирования на 3 часа (180 минут)
Set-FhConfiguration -Frequency 180

# Установить срок хранения версий на 3 месяца.
# Возможные значения (в месяцах): 0 (Forever), 1, 2, 3, 6, 9, 12, 24.
Set-FhConfiguration -RetentionAge 3
```

#### 4. Управление защищаемыми папками

Вы можете добавлять папки в список для отслеживания или исключать их.

```powershell
# Добавить папку с проектами в список защищаемых
Add-FhExcludedFolder -Path "C:\Users\user\Projects"

# Исключить папку с временными файлами из бэкапа
Add-FhExcludedFolder -Path "C:\Users\user\Documents\Temp"
```

#### 5. Запуск резервного копирования вручную

Для немедленного запуска процесса используется `Start-FhBackup`.

```powershell
# Запустить стандартный бэкап
Start-FhBackup

# Запустить бэкап с возможностью взаимодействия с пользователем (например, если диск отключен)
Start-FhBackup -AllowUserInteraction
```

#### 6. Отключение "Истории файлов"

```powershell
Set-FhConfiguration -Enabled $false
Write-Host "История файлов отключена."
```

#### Восстановление файлов

Для восстановления файлов наиболее удобным является графический интерфейс, который позволяет визуально перемещаться по временной шкале. Он запускается из окна **"История файлов"** -> **"Восстановление личных файлов"**.

#### Итог

"История файлов" и "Образ системы" предоставляют два разных уровня защиты данных. "История файлов" является эффективным средством для защиты от повседневных ошибок пользователя. Управление этим инструментом с помощью PowerShell позволяет автоматизировать его настройку и интегрировать в более сложные сценарии администрирования.