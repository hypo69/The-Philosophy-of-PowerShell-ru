### סקריפט ביקורת רישום

סקריפט זה מבצע ארבע בדיקות מפתח:

1.  **הפעלה אוטומטית:** מחפש תוכניות המופעלות עם המערכת במפתחות הרישום הפופולריים ביותר.
2.  **הגדרות אבטחה:** בודק את מצב UAC (בקרת חשבון משתמש).
3.  **מידע מערכת:** מציג את גרסת Windows ומידע חשוב אחר.
4.  **היסטוריית התקני USB:** מציג מידע על כל התקני ה-USB שהתחברו אי פעם.

**חשוב:** סקריפט זה עשוי לדרוש הרשאות מנהל מערכת כדי לפעול.

**פקודה שתוכל להשתמש בה ב-Gemini CLI:**

```powershell
gemini-cli "כתוב סקריפט PowerShell לביקורת רישום מקיפה. הסקריפט צריך לבדוק הפעלה אוטומטית עבור HKLM ו-HKCU, מצב UAC, גרסת Windows והיסטוריית התקני USB מחוברים. הפלט צריך להיות מובנה וקל לקריאה."
```

**דוגמה לסקריפט שנוצר:**

```powershell
Write-Host "--- ביקורת רישום Windows מקיפה ---" -ForegroundColor Green
Write-Host "הסקריפט בודק אזורי רישום מפתח עבור מידע מערכת ואבטחה." -ForegroundColor Cyan

# 1. בדיקת תוכניות הפעלה אוטומטית
Write-Host "`n[1] בדיקת תוכניות הפעלה אוטומטית" -ForegroundColor Yellow
$autoRunPaths = @(
    "HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Run",
    "HKCU:\Software\Microsoft\Windows\CurrentVersion\Run",
    "HKLM:\SOFTWARE\WOW6432Node\Microsoft\Windows\CurrentVersion\Run"
)

foreach ($path in $autoRunPaths) {
    if (Test-Path -Path $path) {
        Write-Host "  - בדיקת מפתח: $path" -ForegroundColor Cyan
        Get-ItemProperty -Path $path -ErrorAction SilentlyContinue | ForEach-Object {
            $name = $_.PSChildName
            $value = $_.$name
            if ($value) {
                Write-Host "    - שם: $name" -ForegroundColor Magenta
                Write-Host "      נתיב:   $value" -ForegroundColor Magenta
            }
        }
    }
}


# 2. בדיקת הגדרות אבטחה (UAC)
Write-Host "`n[2] בדיקת הגדרות אבטחה" -ForegroundColor Yellow
$uacStatus = (Get-ItemProperty "HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System").EnableLUA
if ($uacStatus -eq 1) {
    Write-Host "  - UAC (בקרת חשבון משתמש): מופעל" -ForegroundColor Green
} else {
    Write-Host "  - UAC (בקרת חשבון משתמש): מושבת" -ForegroundColor Red
}


# 3. קבלת מידע על גרסת Windows
Write-Host "`n[3] מידע מערכת" -ForegroundColor Yellow
$osInfo = Get-ItemProperty "HKLM:\SOFTWARE\Microsoft\Windows NT\CurrentVersion"
Write-Host "  - גרסת מערכת הפעלה: $($osInfo.ProductName) $($osInfo.CurrentVersion)" -ForegroundColor Cyan
Write-Host "  - בניית מערכת הפעלה: $($osInfo.BuildLabEx)" -ForegroundColor Cyan


# 4. ביקורת היסטוריית חיבורי התקני USB
Write-Host "`n[4] היסטוריית חיבורי התקני USB" -ForegroundColor Yellow
Write-Host "  (דורש הרשאות מנהל מערכת)" -ForegroundColor Red
try {
    $usbDevices = Get-ItemProperty "HKLM:\SYSTEM\CurrentControlSet\Enum\USBSTOR\*"
    if ($usbDevices.Count -gt 0) {
        $usbDevices | ForEach-Object {
            Write-Host "  - התקן: $($_.PSChildName)" -ForegroundColor Magenta
            Write-Host "    תיאור: $($_.FriendlyName)" -ForegroundColor Magenta
        }
    } else {
        Write-Host "  - התקני USB לא נמצאו ברישום." -ForegroundColor Green
    }
} catch {
    Write-Host "  - שגיאה: לא ניתן לגשת למפתח התקן USB. הפעל את הסקריפט עם הרשאות מנהל מערכת." -ForegroundColor Red
}


Write-Host "`n--- ביקורת הושלמה ---" -ForegroundColor Green
```

### איך זה עובד?

  * **`Test-Path`**: לפני קריאת נתונים, הסקריפט בודק אם מפתח הרישום קיים. זה עוזר למנוע שגיאות.
  * **`Get-ItemProperty`**: הפקודה הראשית לקריאת ערכים ממפתחות רישום.
  * **איטרציה בנתיבים**: הסקריפט משתמש במערך `$autoRunPaths` כדי לעבור על כל מיקומי ההפעלה האוטומטית העיקריים, כולל תוכניות 32 סיביות במערכת 64 סיביות (`WOW6432Node`).
  * **טיפול בשגיאות**: בלוק `try...catch` משמש לטיפול נכון במצבים שבהם למשתמש אין זכויות גישה למפתחות רישום מסוימים, כגון היסטוריית התקני USB.
  * **פלט מעוצב**: באמצעות `Write-Host` וצבעים שונים, הסקריפט הופך את הדוח לויזואלי וקל יותר לקריאה.

סקריפט זה הוא נקודת התחלה מצוינת לביקורת מעמיקה יותר. תוכל להוסיף לו בדיקות חדשות או לשמור את התוצאות לקובץ לצורך ניתוח מאוחר יותר.
