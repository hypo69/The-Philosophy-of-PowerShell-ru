<h1>Gestión de energía del adaptador de red Wake-on-LAN con PowerShell.</h1>
<p>Una guía detallada para configurar Wake-on-LAN con PowerShell, que cubre los comandos básicos y las formas de resolver problemas típicos que surgen debido a las diferencias en los controladores de los adaptadores de red.</p>
<h4>Paso 1: Identificación del dispositivo.</h4>
<p>Antes de configurar Wake-on-LAN (WOL) para un adaptador de red, debe determinar con precisión con qué dispositivo está trabajando. Para ello, utilice un comando de PowerShell que busque dispositivos por parte de su nombre (por ejemplo, "Realtek" o "Intel").</p>
<p>!(../assets/manage-wol/1.png)</p>
<p>Este comando le dice al sistema:
&gt; "Muéstrame todos los dispositivos cuyo nombre contenga la palabra «Realtek», y muéstrame una tabla con cuatro columnas: nombre completo, estado, clase e ID del sistema."</p>
<ol>
<li><strong><code>Get-PnpDevice</code></strong>: Obtiene una lista completa de todos los dispositivos Plug-and-Play.</li>
<li><strong><code>|</code> (Canalización)</strong>: Pasa la lista más adelante.</li>
<li><strong><code>Where-Object { ... }</code></strong>: Filtra la lista, dejando los dispositivos cuyo nombre (<code>FriendlyName</code>) contenga "Realtek".</li>
<li><strong><code>|</code> (Canalización)</strong>: Pasa la lista filtrada.</li>
<li><strong><code>Select-Object ...</code></strong>: Formatea la salida, mostrando solo las propiedades necesarias.</li>
</ol>
<p><em>Encontrar el dispositivo deseado y tomar el primero de la lista</em></p>
<pre class="line-numbers"><code class="language-powershell">$device = Get-PnpDevice | Where-Object { $_.FriendlyName -like "*Realtek*" } | Select-Object -First 1

*Escribir sus propiedades en variables*

$DeviceName = $device.FriendlyName
$InstanceId = $device.InstanceId
$pmKey = "HKLM:\SYSTEM\CurrentControlSet\Enum\$InstanceId\Device Parameters"
</code></pre>
<h4>Paso 2: Permiso global de activación</h4>
<p>El comando <code>powercfg</code> le da al dispositivo el permiso "oficial" de Windows para activar el sistema.</p>
<pre class="line-numbers"><code class="language-powershell">powercfg -deviceenablewake $DeviceName
</code></pre>
<p>Este comando es equivalente a marcar la casilla "Permitir que este dispositivo reactive el equipo".</p>
<p>Su acción inversa — la desactivación:</p>
<pre class="line-numbers"><code class="language-powershell">powercfg -devicedisablewake $DeviceName
</code></pre>
<h4>Paso 3: Configuración del controlador.</h4>
<p>La configuración de WOL se encuentra en los parámetros propios del controlador, que se almacenan en el registro.
Para marcar la casilla "<strong>Permitir que solo un paquete mágico reactive el equipo</strong>",
utilice el comando <code>Set-ItemProperty</code>.</p>
<pre class="line-numbers"><code class="language-powershell"># Establecer la propiedad
Set-ItemProperty -Path $pmKey -Name "*WakeOnMagicPacket" -Value 1
</code></pre>
<p>Acción inversa — deshabilitar WOL (<code>Value 0</code>):</p>
<pre class="line-numbers"><code class="language-powershell">Set-ItemProperty -Path $pmKey -Name "*WakeOnMagicPacket" -Value 0
</code></pre>
<blockquote>
<p><strong>Problema</strong> El nombre de este parámetro puede diferir entre fabricantes. Por ejemplo, para <strong>Intel</strong> es <code>*WakeOnMagicPacket</code>, y para <strong>Realtek</strong> — <code>WakeOnMagicPacket</code> (sin <code>*</code>). Si la configuración no se aplica, verifique el nombre correcto con el comando <code>Get-ItemProperty -Path $pmKey</code> y úselo.</p>
</blockquote>
<h3>Paso 4: Configuración final a través de CIM</h3>
<p>Para estar completamente seguro de que la configuración de administración de energía se aplica correctamente, utilizamos el estándar moderno <strong>CIM</strong> (Common Information Model).</p>
<pre class="line-numbers"><code class="language-powershell"># Encontrar el objeto CIM asociado a nuestro dispositivo
$adapterCim = Get-CimInstance -Namespace root\wmi -ClassName MSPower_DeviceEnable | Where-Object { $_.InstanceName -like "*$($instanceId.Split('\')[-1])*" }

# Aplicar cambios
if ($adapterCim) {
    Set-CimInstance -CimInstance $adapterCim -Property @{ Enable = $true }
}
</code></pre>
<p><img src="../assets/manage-wol/1.png" alt="1"></p>
