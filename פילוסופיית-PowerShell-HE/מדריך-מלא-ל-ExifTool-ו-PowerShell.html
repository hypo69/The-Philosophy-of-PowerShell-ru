# מדריך מלא ל-ExifTool ו-PowerShell

בכל פעם שאתה מצלם תמונה, המצלמה שלך מקליטה לקובץ לא רק את התמונה עצמה, אלא גם מידע שירות: דגם המצלמה והעדשה, תאריך ושעת הצילום, מהירות תריס, צמצם, ISO, קואורדינטות GPS. נתונים אלה נקראים **EXIF (Exchangeable Image File Format)**.

למרות של-PowerShell יש כלים מובנים לקריאת מטא-נתונים מסוימים, הם מוגבלים. כדי לגשת ל**כל** המידע, יש צורך בכלי מיוחד.
במאמר זה, אני משתמש ב-**ExifTool**.


**ExifTool** הוא כלי עזר חינמי, חוצה פלטפורמות, בקוד פתוח, שנכתב על ידי פיל הארווי. הוא נחשב לסטנדרט הזהב לקריאה, כתיבה ועריכה של מטא-נתונים במגוון רחב של פורמטים של קבצים (תמונות, אודיו, וידאו, PDF ועוד). ExifTool מכיר אלפי תגים ממאות יצרני מכשירים, מה שהופך אותו לכלי המקיף ביותר מסוגו.

### הורדה והגדרה נכונה

לפני כתיבת קוד, עליך להכין את כלי העזר עצמו.

1.  עבור לאתר **הרישמי של ExifTool: [https://exiftool.org/](https://exiftool.org/)**. בעמוד הראשי, מצא והורד את ה-**"Windows Executable"**.

2.  **שינוי שם (שלב קריטי חשוב!):** הקובץ שהורדת ייקרא `exiftool(-k).exe`. זו לא מקריות.

שנה את שמו ל-**`exiftool.exe`** כדי **לבטל את מצב ה"השהיה"**, המיועד למשתמשים המפעילים את התוכנית בלחיצה כפולה.
>

3.  **אחסון:** יש לך שתי אפשרויות עיקריות היכן לאחסן את `exiftool.exe`.
    *   **אפשרות 1 (פשוטה): באותה תיקייה כמו הסקריפט שלך.** זו הדרך הקלה ביותר. סקריפט ה-PowerShell שלך תמיד יוכל למצוא את כלי העזר, מכיוון שהוא נמצא בקרבת מקום. אידיאלי עבור סקריפטים ניידים שאתה מעביר ממחשב למחשב.
    *   **אפשרות 2 (מומלצת לשימוש תכוף): בתיקייה ממשתנה המערכת `PATH`.** משתנה `PATH` הוא רשימה של ספריות שבהן Windows ו-PowerShell מחפשים אוטומטית קבצי הפעלה. 
    אתה יכול ליצור תיקייה (לדוגמה, `C:\Tools`), לשים שם את `exiftool.exe`, ולהוסיף את `C:\Tools` למשתנה המערכת `PATH`. 
    לאחר מכן, תוכל לקרוא ל-`exiftool.exe` מכל תיקייה בכל קונסולה.


סקריפטים להוספה ל-$PATH:
הוספת תיקייה ל-PATH עבור המשתמש הנוכחי
הוספת תיקייה ל-SYSTEM PATH עבור כל המשתמשים

---

## PowerShell ותוכניות חיצוניות

כדי להשתמש ב-ExifTool ביעילות, עליך לדעת כיצד PowerShell מריץ קבצי `.exe` חיצוניים.
הדרך הנכונה והאמינה ביותר להפעלת תוכניות חיצוניות היא **אופרטור הקריאה `&` (אמפרסנד)**.
PowerShell יחזיר שגיאה במקרה שנתיב התוכנית מכיל רווחים. לדוגמה, `C:\My Tools\program.exe`.
`&` (אמפרסנד)** אומר ל-PowerShell: "הטקסט שאחרי במרכאות, הוא הנתיב לקובץ ההפעלה. הפעל אותו, וכל מה שאחריו - אלה הארגומנטים שלו".

```powershell
# תחביר נכון
& "C:\Path With Spaces\program.exe" "argument 1" "argument 2"
```

השתמש תמיד ב-`&` כאשר אתה עובד עם נתיבי תוכניות במשתנים או נתיבים שעשויים להכיל רווחים.

---

## טריקים מעשיים: ExifTool + PowerShell

כעת נשלב את הידע שלנו.

### דוגמה מס' 1: חילוץ בסיסי וצפייה אינטראקטיבית

הדרך הקלה ביותר לקבל את כל הנתונים מתמונה ולבחון אותם היא לבקש אותם בפורמט JSON ולהעביר אותם ל-`Out-ConsoleGridView`.

```powershell
$photoPath = "D:\Photos\IMG_1234.JPG"

# 1. הפעל את exiftool עם המתג -json לפלט מובנה
# 2. המר טקסט JSON לאובייקט PowerShell
#    קרא ל-exiftool.exe ישירות, ללא משתנה ואופרטור קריאה &.
$exifObject = exiftool.exe -json $photoPath | ConvertFrom-Json

# 3. המר את האובייקט ה"רחב" לטבלת "פרמטר-ערך" נוחה
$reportData = $exifObject.psobject.Properties | Select-Object Name, Value

# 4. הצג את התוצאה בחלון אינטראקטיבי לניתוח
$reportData | Out-ConsoleGridView -Title "מטא-נתונים של קובץ: $($photoPath | Split-Path -Leaf)"
```

קוד זה יפתח חלון אינטראקטיבי שבו תוכל למיין נתונים לפי שם פרמטר או ערך, וגם לסנן אותם פשוט על ידי התחלת הקלדה. זה נוח להפליא למציאת המידע הדרוש במהירות.

### דוגמה מס' 2: יצירת דוח נקי ושליחה ל"התקנים" שונים

`Out-ConsoleGridView` הוא רק ההתחלה. אתה יכול לכוון נתונים מעובדים לכל מקום באמצעות cmdlets אחרים של `Out-*`.

נניח שיש לנו נתונים במשתנה `$reportData` מהדוגמה הקודמת.

#### **א) שליחה לקובץ CSV עבור Excel**
```powershell
$reportData | Export-Csv -Path "C:\Reports\photo_exif.csv" -NoTypeInformation -Encoding UTF8
```
הפקודה `Export-Csv` יוצרת קובץ מובנה באופן מושלם שניתן לפתוח ב-Excel או ב-Google Sheets.

#### **ב) שליחה לקובץ טקסט**
```powershell
# לעיצוב יפה, השתמש תחילה ב-Format-Table
$reportData | Format-Table -AutoSize | Out-File -FilePath "C:\Reports\photo_exif.txt"
```
הפקודה `Out-File` תשמור לקובץ עותק טקסט מדויק של מה שאתה רואה בקונסולה.

#### **ג) שליחה ללוח הגזירים**
רוצה להדביק נתונים במהירות לדוא"ל או לצ'אט? השתמש ב-`Out-Clipboard`.
```powershell
$reportData | Format-Table -AutoSize | Out-String | Out-Clipboard
```

כעת תוכל ללחוץ `Ctrl+V` בכל עורך טקסט ולהדביק טבלה מעוצבת בצורה מסודרת.

### דוגמה מס' 3: קבלת נתונים ספציפיים לשימוש בסקריפט

לעתים קרובות אינך זקוק לכל הדוח, אלא רק לערך אחד או שניים. מכיוון ש-$exifObject הוא אובייקט PowerShell רגיל, תוכל לגשת בקלות למאפייניו.

```powershell

$photoPath = "D:\Photos\IMG_1234.JPG"

# קרא ל-exiftool.exe ישירות לפי שם.
# PowerShell ימצא אותו אוטומטית באחת מהתיקיות המפורטות ב-PATH.
$exifObject = exiftool.exe -json $photoPath | ConvertFrom-Json

# 1. צור אובייקט PowerShell אחד עם שמות מאפיינים ברורים.
#    זה דומה ליצירת רשומה מובנית.
$reportObject = [PSCustomObject]@{
    "מצלמה"           = $exifObject.Model
    "תאריך צילום"      = $exifObject.DateTimeOriginal
    "רגישות" = $exifObject.ISO
    "שם קובץ"        = $exifObject.FileName # הוסף שם קובץ להקשר
}

# 2. הצג אובייקט זה בחלון אינטראקטיבי.
#    Out-GridView תיצור אוטומטית עמודות משמות המאפיינים.
$reportObject | Out-ConsoleGridView -Title "מטא-נתונים של קובץ: $(Split-Path $photoPath -Leaf)"
```

גישה זו היא הבסיס לכל אוטומציה רצינית, כגון שינוי שמות קבצים על בסיס תאריך הצילום, מיון תמונות לפי דגם מצלמה, או הוספת סימני מים עם מידע חשיפה.

### דוגמה מס' 4: חילוץ מטא-נתונים בקבוצות מתיקייה

לפעמים צריך לנתח לא רק תמונה אחת, אלא תיקייה שלמה של תמונות.

```powershell
# ציין רק את תיקיית התמונות.
$photoFolder = "D:\Photos"

# קרא ל-exiftool.exe ישירות. אין צורך במשתנה עבור הנתיב ובאופרטור &.
$allExif = exiftool.exe -json "$photoFolder\*.jpg" | ConvertFrom-Json

# המר לפורמט נוח 
$report = foreach ($photo in $allExif) {
    [PSCustomObject]@{
        # --- נתונים בסיסיים על הקובץ והמצלמה ---
        FileName       = $photo.FileName
        DateTime       = $photo.DateTimeOriginal
        CameraMake     = $photo.Make                 # יצרן (לדוגמה, "Canon", "SONY")
        CameraModel    = $photo.Model                 # דגם מצלמה (לדוגמה, "EOS R5")
        LensModel      = $photo.LensID                # שם מלא של דגם העדשה
        
        # --- פרמטרי צילום (חשיפה) ---
        ISO            = $photo.ISO
        ShutterSpeed   = $photo.ShutterSpeed
        Aperture       = $photo.Aperture
        FocalLength    = $photo.FocalLength           # אורך מוקד (לדוגמה, "50.0 mm")
        ExposureMode   = $photo.ExposureProgram       # מצב צילום (לדוגמה, "Manual", "Aperture Priority")
        Flash          = $photo.Flash                 # מידע אם הפלאש הופעל
        
        # --- GPS ונתוני תמונה ---
        GPSPosition    = $photo.GPSPosition           # קואורדינטות GPS כמחרוזת אחת (אם קיימות)
        Dimensions     = "$($photo.ImageWidth)x$($photo.ImageHeight)" # מימדי תמונה בפיקסלים
    }
}

# הצג נתונים בטבלה אינטראקטיבית בקונסולה
$report | Out-ConsoleGridView -Title "דוח סיכום לתיקייה: $photoFolder"
```

💡 אתה מקבל טבלה מסודרת עבור כל התיקייה בבת אחת.

---

### דוגמה מס' 5: חיפוש רקורסיבי בתיקיות משנה

ExifTool יודע לחפש קבצים בכל תיקיות המשנה באמצעות המתג `-r`.

```powershell
& $exifToolPath -r -json "D:\Photos" | ConvertFrom-Json |
    Select-Object FileName, Model, DateTimeOriginal |
    Export-Csv "C:\Reports\all_photos_recursive.csv" -NoTypeInformation -Encoding UTF8
```

---

### דוגמה מס' 6: שינוי שמות קבצים לפי תאריך צילום

זהו אחד מתרחישי האוטומציה הפופולריים ביותר — קבצים מקבלים שמות לפי תאריך/שעת הצילום.

```powershell
$exifToolPath = "C:\Tools\exiftool.exe"
$photoFolder = "D:\Photos"

# שנה שם לפורמט YYYY-MM-DD_HH-MM-SS.jpg
& $exifToolPath -r -d "%Y-%m-%d_%H-%M-%S.%%e" "-FileName<DateTimeOriginal" $photoFolder
```

💡 *ExifTool יחליף אוטומטית את סיומת הקובץ המקורית באמצעות `%%e`.*

---

### דוגמה מס' 7: חילוץ קואורדינטות GPS בלבד

שימושי אם אתה רוצה לבנות מפה מהתמונות שלך.

```powershell
# 1. ציין את הנתיב לתיקיית התמונות שלך
$photoFolder = "E:\DCIM\Camera"

# 2. רשום את התגים שאנו צריכים: שם קובץ ושלושה תגי GPS.
#    זה הופך את השאילתה למהירה הרבה יותר מאשר אם היינו מאחזרים את כל התגים.
$tagsToExtract = @(
    "-SourceFile", # SourceFile עדיף על FileName, מכיוון שהוא בדרך כלל מכיל את הנתיב המלא
    "-GPSLatitude",
    "-GPSLongitude",
    "-GPSAltitude"
)

# 3. קרא ל-exiftool.exe ישירות (מכיוון שהוא ב-PATH).
#    המתג -r מחפש קבצים בכל תיקיות המשנה.
#    המר את התוצאה ישירות מ-JSON.
$allExifData = exiftool.exe -r -json $tagsToExtract $photoFolder | ConvertFrom-Json

# 4. סנן את התוצאות: השאר רק את האובייקטים שיש להם קו רוחב וקו אורך.
$filesWithGps = $allExifData | Where-Object { $_.GPSLatitude -and $_.GPSLongitude }

# 5. בדוק אם בכלל נמצאו קבצים עם נתוני GPS
if ($filesWithGps) {
    # 6. צור דוח יפה מהנתונים המסוננים.
    #    השתמש ב-Select-Object כדי לשנות שמות עמודות ולעצב.
    $report = $filesWithGps | Select-Object @{Name="שם קובץ"; Expression={Split-Path $_.SourceFile -Leaf}},
                                             @{Name="קו רוחב"; Expression={$_.GPSLatitude}},
                                             @{Name="קו אורך"; Expression={$_.GPSLongitude}},
                                             @{Name="גובה"; Expression={if ($_.GPSAltitude) { "$($_.GPSAltitude) מ" } else { "N/A" }}}
    
    # 7. הצג את הדוח הסופי בטבלת קונסולה אינטראקטיבית.
    $report | Out-ConsoleGridView -Title "קבצים עם נתוני GPS בתיקייה: $photoFolder"

} else {
    # אם לא נמצא דבר, הודע למשתמש בנימוס.
    Write-Host "לא נמצאו קבצים עם נתוני GPS בתיקייה '$photoFolder'." -ForegroundColor Yellow
}
```

---

### דוגמה מס' 8: הסרה המונית של כל נתוני ה-GPS (לצורך פרטיות)

```powershell
# הסר את כל תגי ה-GPS מ-JPG ו-PNG
& $exifToolPath -r -overwrite_original -gps:all= "D:\Photos"
```

💡 *פעולה זו בלתי הפיכה, לכן גבה לפני הביצוע.*

---

### דוגמה מס' 9: המרת זמן צילום לזמן מקומי

לפעמים תמונות צולמו באזור זמן אחר. ExifTool יכול להזיז את התאריך.

```powershell
# הזז זמן ב-+3 שעות
& $exifToolPath "-AllDates+=3:0:0" "D:\Photos\IMG_*.JPG"
```

---

### דוגמה מס' 10: קבלת רשימה של כל דגמי המצלמות הייחודיים בתיקייה

```powershell
$models = & $exifToolPath -r -Model -s3 "D:\Photos" | Sort-Object -Unique
$models | ForEach-Object { Write-Host "דגם: $_" }
```

---

### דוגמה מס' 11: הצגת תגים נחוצים בלבד בצורת טבלה

```powershell
& $exifToolPath -T -Model -DateTimeOriginal -ISO -Aperture -ShutterSpeed "D:\Photos\IMG_1234.JPG"
```

`-T` מוציא פלט בפורמט טבלאי, מופרד בטאבים — נוח לעיבוד נוסף.

---

### דוגמה מס' 12: בדיקת נוכחות GPS במערך קבצים גדול

```powershell
$files = & $exifToolPath -r -if "$gpslatitude" -p '$FileName' "D:\Photos"
Write-Host "קבצים עם GPS:"
$files
```

---

### דוגמה מס' 13: העתקת מטא-נתונים מקובץ אחד לאחר

```powershell
# 1. בחר קובץ מקור
$sourceFile = Get-ChildItem "D:\Photos" -Filter "*.jpg" | Out-ConsoleGridView -Title "בחר קובץ מקור"

# 2. אם נבחר מקור, בחר קבצי יעד
if ($sourceFile) {
    $targetFiles = Get-ChildItem "D:\Photos\New" -Filter "*.jpg" | Out-ConsoleGridView -Title "בחר קבצי יעד להעתקת מטא-נתונים" -OutputMode Multiple
    
    # 3. אם נבחרו יעדים, בצע העתקה
    if ($targetFiles) {
        & exiftool.exe -TagsFromFile $sourceFile.FullName ($targetFiles.FullName)
        Write-Host "מטא-נתונים הועתקו מ-$($sourceFile.Name) ל-$($targetFiles.Count) קבצים."
    }
}
```

---

### דוגמה מס' 14: שמירת מטא-נתונים מקוריים ל-JSON נפרד לפני שינוי

```powershell
$backupPath = "C:\Reports\metadata_backup.json"
& $exifToolPath -r -json "D:\Photos" | Out-File -Encoding UTF8 $backupPath
```

---

### דוגמה מס' 15: שימוש ב-PowerShell למיון תמונות אוטומטי לפי תאריך

```powershell
$photos = Get-ChildItem "D:\Photos" -Filter *.jpg -Recurse
foreach ($photo in $photos) {
    $meta = & $exifToolPath -json $photo.FullName | ConvertFrom-Json
    $date = Get-Date $meta.DateTimeOriginal -ErrorAction SilentlyContinue
    if ($date) {
        $targetFolder = "D:\Sorted\{0:yyyy}\{0:MM}" -f $date
        if (-not (Test-Path $targetFolder)) { New-Item -Path $targetFolder -ItemType Directory }
        Move-Item $photo.FullName -Destination $targetFolder
    }
}
```

---


### דוגמה 16: מציאת כל דגמי המצלמות הייחודיים באוסף

למרות שניתן לעשות זאת בשורה אחת, הצגה ב-`GridView` מאפשרת להעתיק מיד את שם הדגם הרצוי.

```powershell
# המתג -s3 מוציא רק ערכים, -Model - שם תג
$uniqueModels = & exiftool.exe -r -Model -s3 "D:\Photos" | Sort-Object -Unique

# הצג ב-GridView לצפייה והעתקה קלה
$uniqueModels | Out-ConsoleGridView -Title "דגמי מצלמות ייחודיים באוסף"
```
