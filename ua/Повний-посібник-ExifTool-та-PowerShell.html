<h1>Повний посібник з ExifTool та PowerShell</h1>
<p>Щоразу, коли ви робите фотографію, ваша камера записує у файл не лише саме зображення, а й службову інформацію: модель камери та об'єктива, дату та час зйомки, витримку, діафрагму, ISO, GPS-координати. Ці дані називаються **EXIF (Exchangeable Image File Format)**.</p>
<p>Хоча PowerShell має вбудовані засоби для читання деяких метаданих, вони обмежені. Щоб отримати доступ до **всієї** інформації, потрібен спеціалізований інструмент. У цій статті я використовую **ExifTool**.</p>
<p>**ExifTool** — це безкоштовна, крос-платформна утиліта з відкритим вихідним кодом, написана Філом Харві. Вона є золотим стандартом для читання, запису та редагування метаданих у найрізноманітніших форматах файлів (зображення, аудіо, відео, PDF та ін.). ExifTool знає тисячі тегів від сотень виробників пристроїв, що робить його найповнішим інструментом у своєму класі.</p>
<h3>Завантаження та правильне налаштування</h3>
<p>Перш ніж писати код, потрібно підготувати саму утиліту.</p>
<ol>
<li>Зайдіть на **офіційний сайт ExifTool: <a href="https://exiftool.org/">https://exiftool.org/</a>**. На головній сторінці знайдіть і завантажте **"Windows Executable"**.

2.  **Перейменування (Критично важливий крок!):** Завантажений файл буде називатися <code>exiftool(-k).exe</code>. Це не випадковість.</li>
</ol>
<p>Перейменуйте його на **<code>exiftool.exe</code>**, щоб **вимкнути режим "паузи"**, який призначений для користувачів, що запускають програму подвійним клацанням миші.</p>
<blockquote>
<p></p>
</blockquote>
<ol>
<li>**Зберігання:** У вас є два основні варіанти, де зберігати <code>exiftool.exe</code>.
<ul>
<li>**Варіант 1 (Простий): У тій же папці, що й ваш скрипт.** Це найлегший шлях. Ваш скрипт PowerShell завжди зможе знайти утиліту, оскільки вона лежить поруч. Ідеально для портативних скриптів, які ви переносите з комп'ютера на комп'ютер.</li>
<li>**Варіант 2 (Рекомендований для частого використання): У папці зі системної змінної <code>PATH</code>.** Змінна <code>PATH</code> — це список директорій, де Windows і PowerShell автоматично шукають виконувані файли.<br />Ви можете створити папку (наприклад, <code>C:\Tools</code>), покласти туди <code>exiftool.exe</code> і додати <code>C:\Tools</code> до системної змінної <code>PATH</code>.<br />Після цього ви зможете викликати <code>exiftool.exe</code> з будь-якої папки в будь-якій консолі.</li>
</ul>
</li>
</ol>
<p>Скрипти для додавання в $PATH:<br />Додавання директорії в PATH для ПОТОЧНОГО КОРИСТУВАЧА<br />Додавання директорії в СИСТЕМНИЙ PATH для ВСІХ КОРИСТУВАЧІВ</p>
<hr />
<h2>PowerShell та зовнішні програми</h2>
<p>Щоб ефективно використовувати ExifTool, потрібно знати, як PowerShell запускає зовнішні <code>.exe</code> файли.<br />Правильний і найнадійніший спосіб запуску зовнішніх програм — це **оператор виклику <code>&amp;</code> (амперсанд)**.<br />PowerShell видасть помилку у випадку, якщо шлях до програми містить пробіли. Наприклад, <code>C:\My Tools\exiftool.exe</code>.<br /><code>&amp;</code> (амперсанд)** говорить PowerShell: "Текст, який слідує за мною в лапках, — це шлях до виконуваного файлу. Запусти його, а все, що йде далі, — це його аргументи".</p>
<pre class="line-numbers"><code class="language-powershell"># Правильний синтаксис
&amp; "C:\Path With Spaces\program.exe" "аргумент 1" "аргумент 2"
</code></pre>
<p>Завжди використовуйте <code>&amp;</code>, коли працюєте зі шляхами до програм у змінних або шляхами, які можуть містити пробіли.</p>
<hr />
<h2>Практичні трюки: ExifTool + PowerShell</h2>
<p>Тепер об'єднаємо наші знання.</p>
<h3>Приклад №1: Базове вилучення та інтерактивний перегляд</h3>
<p>Найпростіший спосіб отримати всі дані з фото та вивчити їх — це запросити їх у форматі JSON та передати в <code>Out-ConsoleGridView</code>.</p>
<pre class="line-numbers"><code class="language-powershell">
$photoPath = "D:\Photos\IMG_1234.JPG"

# 1. Запускаємо exiftool з ключем -json для структурованого виводу
# 2. Перетворюємо JSON-текст в об'єкт PowerShell
#    Викликаємо exiftool.exe безпосередньо, без змінної та оператора виклику &amp;.
$exifObject = exiftool.exe -json $photoPath | ConvertFrom-Json

# 3. Перетворюємо "широкий" об'єкт на зручну таблицю "Параметр-Значення"
$reportData = $exifObject.psobject.Properties | Select-Object Name, Value

# 4. Виводимо результат в інтерактивне вікно для аналізу
$reportData | Out-ConsoleGridView -Title "Метадані файлу: $($photoPath | Split-Path -Leaf)"
</code></pre>
<p>Цей код відкриє інтерактивне вікно, де ви зможете відсортувати дані за іменем параметра або значенням, а також відфільтрувати їх, просто почавши вводити текст. Це неймовірно зручно для швидкого пошуку потрібної інформації.</p>
<h3>Приклад №2: Створення чистого звіту та відправка на різні "пристрої"</h3>
<p><code>Out-ConsoleGridView</code> — це лише початок. Ви можете направити оброблені дані куди завгодно, використовуючи інші командлети <code>Out-*</code>.</p>
<p>Припустимо, у нас є дані в змінній <code>$reportData</code> з попереднього прикладу.</p>
<h4><strong>А) Відправка в CSV-файл для Excel</strong></h4>
<pre class="line-numbers"><code class="language-powershell">$reportData | Export-Csv -Path "C:\Reports\photo_exif.csv" -NoTypeInformation -Encoding UTF8
</code></pre>
<p>Команда <code>Export-Csv</code> створює ідеально структурований файл, який можна відкрити в Excel або Google Таблицях.</p>
<h4><strong>Б) Відправка в текстовий файл</strong></h4>
<pre class="line-numbers"><code class="language-powershell"># Для красивого форматування спочатку використовуємо Format-Table
$reportData | Format-Table -AutoSize | Out-File -FilePath "C:\Reports\photo_exif.txt"
</code></pre>
<p>Команда <code>Out-File</code> збереже у файл точну текстову копію того, що ви бачите в консолі.</p>
<h4><strong>В) Відправка в буфер обміну</strong></h4>
<p>Хочете швидко вставити дані в лист або чат? Використовуйте <code>Out-Clipboard</code>.</p>
<pre class="line-numbers"><code class="language-powershell">$reportData | Format-Table -AutoSize | Out-String | Out-Clipboard
</code></pre>
<p>Тепер ви можете натиснути <code>Ctrl+V</code> в будь-якому текстовому редакторі та вставити акуратно відформатовану таблицю.</p>
<h3>Приклад №3: Отримання конкретних даних для використання в скрипті</h3>
<p>Часто вам не потрібен весь звіт, а лише одне або два значення. Оскільки <code>$exifObject</code> — це звичайний об'єкт PowerShell, ви можете легко звертатися до його властивостей.</p>
<pre class="line-numbers"><code class="language-powershell">
$photoPath = "D:\Photos\IMG_1234.JPG"

# Викликаємо exiftool.exe безпосередньо за іменем.
# PowerShell автоматично знайде його в одній з папок, перелічених в PATH.
$exifObject = exiftool.exe -json $photoPath | ConvertFrom-Json

# 1. Створюємо один PowerShell-об'єкт зі зрозумілими іменами властивостей.
#    Це схоже на створення структурованого запису.
$reportObject = [PSCustomObject]@{
    "Камера"           = $exifObject.Model
    "Дата зйомки"      = $exifObject.DateTimeOriginal
    "Чутливість" = $exifObject.ISO
    "Ім'я файлу"        = $exifObject.FileName # Додамо ім'я файлу для контексту
}

# 2. Виводимо цей об'єкт в інтерактивне вікно.
#    Out-GridView автоматично створить колонки з імен властивостей.
$reportObject | Out-ConsoleGridView -Title "Метадані файлу: $($photoPath | Split-Path -Leaf)"
</code></pre>
<p>Цей підхід є основою для будь-якої серйозної автоматизації, такої як перейменування файлів на основі дати зйомки, сортування фотографій за моделлю камери або додавання водяних знаків з інформацією про витримку.

<h3>Приклад №4: Пакетне вилучення метаданих з папки</h3>
<p>Іноді потрібно проаналізувати не одне фото, а цілу папку із зображеннями.</p>
<pre class="line-numbers"><code class="language-powershell"># Вказуємо тільки папку з фотографіями.
$photoFolder = "D:\Photos"

# Викликаємо exiftool.exe безпосередньо. Змінна для шляху та оператор &amp; не потрібні.
$allExif = exiftool.exe -json "$photoFolder\*.jpg" | ConvertFrom-Json

# Перетворюємо в зручний вигляд
$report = foreach ($photo in $allExif) {
    [PSCustomObject]@{
        # --- Основні дані про файл та камеру ---
        FileName       = $photo.FileName
        DateTime       = $photo.DateTimeOriginal
        CameraMake     = $photo.Make                 # Виробник (наприклад, "Canon", "SONY")
        CameraModel    = $photo.Model                 # Модель камери (наприклад, "EOS R5")
        LensModel      = $photo.LensID                # Повна назва моделі об'єктива
        
        # --- Параметри зйомки (експозиція) ---
        ISO            = $photo.ISO
        ShutterSpeed   = $photo.ShutterSpeed
        Aperture       = $photo.Aperture
        FocalLength    = $photo.FocalLength           # Фокусна відстань (наприклад, "50.0 mm")
        ExposureMode   = $photo.ExposureProgram       # Режим зйомки (наприклад, "Manual", "Aperture Priority")
        Flash          = $photo.Flash                 # Інформація про те, чи спрацював спалах
        
        # --- GPS та дані зображення ---
        GPSPosition    = $photo.GPSPosition           # Координати GPS у вигляді одного рядка (якщо є)
        Dimensions     = "$($photo.ImageWidth)x$($photo.ImageHeight)" # Розміри зображення в пікселях
    }
}

# Виводимо дані в інтерактивну таблицю в КОНСОЛІ
$report | Out-ConsoleGridView -Title "Зведений звіт по папці: $photoFolder"
</code></pre>
<p>💡 Ви отримуєте акуратну таблицю для всієї папки відразу.</p>
<hr />
<h3>Приклад №5: Рекурсивний пошук по підпапках</h3>
<p>ExifTool вміє сам шукати файли у всіх підпапках при використанні ключа <code>-r</code>.</p>
<pre class="line-numbers"><code class="language-powershell">&amp; $exifToolPath -r -json "D:\Photos" | ConvertFrom-Json |
    Select-Object FileName, Model, DateTimeOriginal |
    Export-Csv "C:\Reports\all_photos_recursive.csv" -NoTypeInformation -Encoding UTF8
</code></pre>
<hr />
<h3>Приклад №6: Перейменування файлів за датою зйомки</h3>
<p>Це один з найпопулярніших сценаріїв автоматизації — файли отримують імена за датою/часом зйомки.</p>
<pre class="line-numbers"><code class="language-powershell">$exifToolPath = "C:\Tools\exiftool.exe"
$photoFolder = "D:\Photos"

# Перейменуємо у формат YYYY-MM-DD_HH-MM-SS.jpg
&amp; $exifToolPath -r -d "%Y-%m-%d_%H-%M-%S.%%e" "-FileName&lt;DateTimeOriginal" $photoFolder
</code></pre>
<p>💡 <em>ExifTool підставить розширення вихідного файлу автоматично через <code>%%e</code>.</em></p>
<hr />
<h3>Приклад №7: Вилучення лише GPS-координат</h3>
<p>Корисно, якщо ви хочете побудувати карту за вашими фото.</p>
<pre class="line-numbers"><code class="language-powershell"># 1. Вкажіть шлях до папки з вашими фотографіями
$photoFolder = "E:\DCIM\Camera"

# 2. Перелічуємо теги, які нам потрібні: ім'я файлу та три GPS-теги.
#    Це робить запит набагато швидшим, ніж якби ми забирали всі теги.
$tagsToExtract = @(
    "-SourceFile", # SourceFile краще, ніж FileName, оскільки зазвичай містить повний шлях
    "-GPSLatitude",
    "-GPSLongitude",
    "-GPSAltitude"
)

# 3. Викликаємо exiftool.exe безпосередньо (оскільки він в PATH).
#    Ключ -r шукає файли у всіх підпапках.
#    Результат відразу конвертуємо з JSON.
$allExifData = exiftool.exe -r -json $tagsToExtract $photoFolder | ConvertFrom-Json

# 4. Фільтруємо результати: залишаємо ТІЛЬКИ ті об'єкти, у яких є широта та довгота.
$filesWithGps = $allExifData | Where-Object { $_.GPSLatitude -and $_.GPSLongitude }

# 5. Перевіряємо, чи знайшлися взагалі файли з GPS-даними
if ($filesWithGps) {
    # 6. Створюємо красивий звіт з відфільтрованих даних.
    #    Використовуємо Select-Object для перейменування колонок та форматування.
    $report = $filesWithGps | Select-Object @{Name="Ім'я файлу"; Expression={Split-Path $_.SourceFile -Leaf}},
                                             @{Name="Широта"; Expression={$_.GPSLatitude}},
                                             @{Name="Довгота"; Expression={$_.GPSLongitude}},
                                             @{Name="Висота"; Expression={if ($_.GPSAltitude) { "$($_.GPSAltitude) м" } else { "N/A" }}}
    
    # 7. Виводимо підсумковий звіт в інтерактивну консольну таблицю.
    $report | Out-ConsoleGridView -Title "Файли з GPS-даними в папці: $photoFolder"

} else {
    # Якщо нічого не знайдено, ввічливо повідомляємо про це.
    Write-Host "Файли з GPS-даними в папці '$photoFolder' не знайдено." -ForegroundColor Yellow
}
```

---

### Приклад №8: Масове видалення всіх GPS-даних (для приватності)

```powershell
# Видалимо всі GPS-теги з JPG та PNG
& $exifToolPath -r -overwrite_original -gps:all= "D:\Photos"
```

💡 *Ця дія незворотна, тому робіть бекап перед виконанням.*

---

### Приклад №9: Конвертація часу зйомки в місцевий час

Іноді фото зняті в іншому часовому поясі. ExifTool може змістити дату.

```powershell
# Зміщуємо час на +3 години
& $exifToolPath "-AllDates+=3:0:0" "D:\Photos\IMG_*.JPG"
```

---

### Приклад №10: Отримання списку всіх унікальних моделей камер у папці

```powershell
$models = & $exifToolPath -r -Model -s3 "D:\Photos" | Sort-Object -Unique
$models | ForEach-Object { Write-Host "Модель: $_" }
```

---

### Приклад №11: Вивід лише потрібних тегів у табличному вигляді

```powershell
& $exifToolPath -T -Model -DateTimeOriginal -ISO -Aperture -ShutterSpeed "D:\Photos\IMG_1234.JPG"
```

`-T` виводить у табличному форматі, розділеному табуляцією — зручно для подальшої обробки.

---

### Приклад №12: Перевірка наявності GPS у великому масиві файлів

```powershell
$files = & $exifToolPath -r -if "$gpslatitude" -p '$FileName' "D:\Photos"
Write-Host "Файли з GPS:"
$files
```

---

### Приклад №13: Копіювання метаданих з одного файлу на інший

```powershell
# 1. Вибираємо еталонний файл
$sourceFile = Get-ChildItem "D:\Photos" -Filter "*.jpg" | Out-ConsoleGridView -Title "Виберіть ЕТАЛОННИЙ файл"

# 2. Якщо еталон вибрано, вибираємо цільові файли
if ($sourceFile) {
    $targetFiles = Get-ChildItem "D:\Photos\New" -Filter "*.jpg" | Out-ConsoleGridView -Title "Виберіть ЦІЛЬОВІ файли для копіювання метаданих" -OutputMode Multiple
    
    # 3. Якщо цілі вибрано, виконуємо копіювання
    if ($targetFiles) {
        & exiftool.exe -TagsFromFile $sourceFile.FullName ($targetFiles.FullName)
        Write-Host "Метадані скопійовані з $($sourceFile.Name) на $($targetFiles.Count) файлів."
    }
}
```

---

### Приклад №14: Збереження вихідних метаданих в окремий JSON перед зміною

```powershell
$backupPath = "C:\Reports\metadata_backup.json"
& $exifToolPath -r -json "D:\Photos" | Out-File -Encoding UTF8 $backupPath
```

---

### Приклад №15: Використання PowerShell для автоматичного сортування фото за датою

```powershell
$photos = Get-ChildItem "D:\Photos" -Filter *.jpg -Recurse
foreach ($photo in $photos) {
    $meta = & $exifToolPath -json $photo.FullName | ConvertFrom-Json
    $date = Get-Date $meta.DateTimeOriginal -ErrorAction SilentlyContinue
    if ($date) {
        $targetFolder = "D:\Sorted\{0:yyyy}\{0:MM}" -f $date
        if (-not (Test-Path $targetFolder)) { New-Item -Path $targetFolder -ItemType Directory }
        Move-Item $photo.FullName -Destination $targetFolder
    }
}
```

---


### Приклад 16: Пошук всіх унікальних моделей камер в колекції

Хоча це можна зробити одним рядком, вивід в `GridView` дозволяє відразу скопіювати потрібну назву моделі.

```powershell
# Ключ -s3 виводить тільки значення, -Model - назва тега
$uniqueModels = & exiftool.exe -r -Model -s3 "D:\Photos" | Sort-Object -Unique

# Виводимо в GridView для зручного перегляду та копіювання
$uniqueModels | Out-ConsoleGridView -Title "Унікальні моделі камер в колекції"
```
